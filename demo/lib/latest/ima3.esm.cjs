/* CJS | Version: 0.0.5 | Commit: 755b4a0 */
"use strict";var V=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var re=Object.prototype.hasOwnProperty;var de=(l,e)=>{for(var t in e)V(l,t,{get:e[t],enumerable:!0})},le=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ae(e))!re.call(l,s)&&s!==t&&V(l,s,{get:()=>e[s],enumerable:!(i=se(e,s))||i.enumerable});return l};var oe=l=>le(V({},"__esModule",{value:!0}),l);var Le={};de(Le,{Ad:()=>D,AdDisplayContainer:()=>$,AdError:()=>S,AdErrorEvent:()=>y,AdEvent:()=>C,AdPodInfo:()=>M,AdsLoader:()=>G,AdsManager:()=>P,AdsManagerLoadedEvent:()=>k,AdsRenderingSettings:()=>W,AdsRequest:()=>Y,ImaSdkSettings:()=>g,VERSION:()=>ye,ViewMode:()=>ge,activateDebug:()=>Se,settings:()=>Z});module.exports=oe(Le);var z="0.0.5";var O=(n=>(n[n.DEPRECATED_ERROR_CODE=-1]="DEPRECATED_ERROR_CODE",n[n.VAST_MALFORMED_RESPONSE=-1]="VAST_MALFORMED_RESPONSE",n[n.VAST_SCHEMA_VALIDATION_ERROR=101]="VAST_SCHEMA_VALIDATION_ERROR",n[n.VAST_UNSUPPORTED_VERSION=102]="VAST_UNSUPPORTED_VERSION",n[n.VAST_TRAFFICKING_ERROR=200]="VAST_TRAFFICKING_ERROR",n[n.VAST_UNEXPECTED_LINEARITY=201]="VAST_UNEXPECTED_LINEARITY",n[n.VAST_UNEXPECTED_DURATION_ERROR=202]="VAST_UNEXPECTED_DURATION_ERROR",n[n.VAST_WRAPPER_ERROR=300]="VAST_WRAPPER_ERROR",n[n.VAST_LOAD_TIMEOUT=301]="VAST_LOAD_TIMEOUT",n[n.VAST_TOO_MANY_REDIRECTS=302]="VAST_TOO_MANY_REDIRECTS",n[n.VAST_NO_ADS_AFTER_WRAPPER=303]="VAST_NO_ADS_AFTER_WRAPPER",n[n.VIDEO_PLAY_ERROR=400]="VIDEO_PLAY_ERROR",n[n.VAST_MEDIA_LOAD_TIMEOUT=402]="VAST_MEDIA_LOAD_TIMEOUT",n[n.VAST_LINEAR_ASSET_MISMATCH=403]="VAST_LINEAR_ASSET_MISMATCH",n[n.VAST_PROBLEM_DISPLAYING_MEDIA_FILE=405]="VAST_PROBLEM_DISPLAYING_MEDIA_FILE",n[n.OVERLAY_AD_PLAYING_FAILED=500]="OVERLAY_AD_PLAYING_FAILED",n[n.NONLINEAR_DIMENSIONS_ERROR=501]="NONLINEAR_DIMENSIONS_ERROR",n[n.OVERLAY_AD_LOADING_FAILED=-1]="OVERLAY_AD_LOADING_FAILED",n[n.VAST_NONLINEAR_ASSET_MISMATCH=503]="VAST_NONLINEAR_ASSET_MISMATCH",n[n.COMPANION_REQUIRED_ERROR=602]="COMPANION_REQUIRED_ERROR",n[n.COMPANION_AD_LOADING_FAILED=-1]="COMPANION_AD_LOADING_FAILED",n[n.UNKNOWN_ERROR=900]="UNKNOWN_ERROR",n[n.VPAID_ERROR=901]="VPAID_ERROR",n[n.FAILED_TO_REQUEST_ADS=1005]="FAILED_TO_REQUEST_ADS",n[n.VAST_ASSET_NOT_FOUND=1007]="VAST_ASSET_NOT_FOUND",n[n.VAST_EMPTY_RESPONSE=1009]="VAST_EMPTY_RESPONSE",n[n.UNKNOWN_AD_RESPONSE=1010]="UNKNOWN_AD_RESPONSE",n[n.UNSUPPORTED_LOCALE=1011]="UNSUPPORTED_LOCALE",n[n.ADS_REQUEST_NETWORK_ERROR=1012]="ADS_REQUEST_NETWORK_ERROR",n[n.INVALID_AD_TAG=1013]="INVALID_AD_TAG",n[n.PROTECTED_AUDIENCE_API_ERROR=1014]="PROTECTED_AUDIENCE_API_ERROR",n[n.STREAM_INITIALIZATION_FAILED=1020]="STREAM_INITIALIZATION_FAILED",n[n.ASSET_FALLBACK_FAILED=1021]="ASSET_FALLBACK_FAILED",n[n.UNSUPPORTED_URL=1022]="UNSUPPORTED_URL",n[n.INVALID_ARGUMENTS=1101]="INVALID_ARGUMENTS",n[n.NATIVE_MESSAGE_ERROR=1204]="NATIVE_MESSAGE_ERROR",n[n.AUTOPLAY_DISALLOWED=1205]="AUTOPLAY_DISALLOWED",n[n.CONSENT_MANAGEMENT_PROVIDER_NOT_READY=1300]="CONSENT_MANAGEMENT_PROVIDER_NOT_READY",n[n.Cj=2002]="Cj",n[n.VIDEO_ELEMENT_USED=-1]="VIDEO_ELEMENT_USED",n[n.VIDEO_ELEMENT_REQUIRED=-1]="VIDEO_ELEMENT_REQUIRED",n[n.VAST_MEDIA_ERROR=-1]="VAST_MEDIA_ERROR",n[n.ADSLOT_NOT_VISIBLE=-1]="ADSLOT_NOT_VISIBLE",n))(O||{});var x=(t=>(t.AD_LOAD="adLoadError",t.AD_PLAY="adPlayError",t))(x||{});var N=(e=>(e.AD_ERROR="adError",e))(N||{});var w=(a=>(a.AD_CAN_PLAY="adCanPlay",a.wi="adStarted",a.CONTENT_PAUSE_REQUESTED="contentPauseRequested",a.CONTENT_RESUME_REQUESTED="contentResumeRequested",a.CLICK="click",a.VIDEO_CLICKED="videoClicked",a.VIDEO_ICON_CLICKED="videoIconClicked",a.Ne="engagedView",a.EXPANDED_CHANGED="expandedChanged",a.STARTED="start",a.AD_PROGRESS="adProgress",a.AD_BUFFERING="adBuffering",a.IMPRESSION="impression",a.Ue="measurable_impression",a.VIEWABLE_IMPRESSION="viewable_impression",a.Oe="fully_viewable_audible_half_duration_impression",a.mg="overlay_resize",a.ng="overlay_unmeasurable_impression",a.og="overlay_unviewable_impression",a.qg="overlay_viewable_immediate_impression",a.pg="overlay_viewable_end_of_session_impression",a.Oi="externalActivityEvent",a.PAUSED="pause",a.RESUMED="resume",a.FIRST_QUARTILE="firstQuartile",a.MIDPOINT="midpoint",a.THIRD_QUARTILE="thirdQuartile",a.COMPLETE="complete",a.DURATION_CHANGE="durationChange",a.USER_CLOSE="userClose",a.Ij="userRecall",a.vj="prefetched",a.LOADED="loaded",a.ALL_ADS_COMPLETED="allAdsCompleted",a.SKIPPED="skip",a.ug="skipShown",a.LINEAR_CHANGED="linearChanged",a.SKIPPABLE_STATE_CHANGED="skippableStateChanged",a.AD_METADATA="adMetadata",a.AD_BREAK_FETCH_ERROR="adBreakFetchError",a.AD_BREAK_READY="adBreakReady",a.LOG="log",a.VOLUME_CHANGED="volumeChange",a.VOLUME_MUTED="mute",a.INTERACTION="interaction",a.Bi="companionBackfill",a.Gj="trackingUrlPinged",a.Jj="video_card_endcap_collapse",a.Kj="video_card_endcap_dismiss",a.Lj="video_card_endcap_impression",a.Ei="companionInitialized",a.Di="companionImpression",a.Ci="companionClick",a.pj="mediaUrlPinged",a.LOAD_START="loadStart",a.rj="navigationRequested",a))(w||{});var U=(e=>(e.ADS_MANAGER_LOADED="adsManagerLoaded",e))(U||{});var F=(t=>(t.ALWAYS="always",t.ON_MASTER_AD="on_master_ad",t))(F||{});var B=(i=>(i[i.DISABLED=0]="DISABLED",i[i.ENABLED=1]="ENABLED",i[i.INSECURE=2]="INSECURE",i))(B||{});var H=(t=>(t.NORMAL="normal",t.FULLSCREEN="fullscreen",t))(H||{});var X=F,J=B,g=class l{static CompanionBackfillMode=X;static VpaidMode=J;autoPlayAdBreaks=!0;cookiesEnabled=!0;companionBackfill=l.CompanionBackfillMode.ALWAYS;featureFlags={};locale="en";vpaidMode=J.ENABLED;numRedirects=-1;disableCustomPlaybackForIOS10Plus=!1;playerType="";playerVersion="";ppid="";sessionId="";allowVpaid=!0;getCompanionBackfill(){return this.companionBackfill}getDisableCustomPlaybackForIOS10Plus(){return!0}getFeatureFlags(){return this.featureFlags}getLocale(){return this.locale}getNumRedirects(){return this.numRedirects}getPlayerType(){return this.playerType}getPlayerVersion(){return this.playerVersion}getPpid(){return this.ppid}isCookiesEnabled(){return this.cookiesEnabled}setAutoPlayAdBreaks(e){this.autoPlayAdBreaks=e}setCompanionBackfill(){this.companionBackfill=X.ALWAYS}setCookiesEnabled(e){this.cookiesEnabled=e}setDisableCustomPlaybackForIOS10Plus(e){this.disableCustomPlaybackForIOS10Plus=e}setFeatureFlags(e){this.featureFlags=e}setLocale(e){this.locale=e}setNumRedirects(e){this.numRedirects=e}setPlayerType(e){this.playerType=e}setPlayerVersion(e){this.playerVersion=e}setPpid(e){this.ppid=e}setSessionId(e){this.sessionId=e}setVpaidAllowed(e){this.allowVpaid=e}setVpaidMode(e){this.vpaidMode=e}};var Z=new g;var _=["debug","info","warn","error","fatal","trace"],pe={debug:console.debug||console.log,info:console.info||console.log,warn:console.warn||console.log,error:console.error||console.log,fatal:console.error||console.log,trace:console.trace||console.log},j=class{enable;level;constructor(e){var i;let t="localStorage"in globalThis?!!((i=globalThis.localStorage)!=null&&i.getItem("advDebug")):!1;this.enable=e.enable||t,this.level=t?"debug":e.level||"info"}debug(e,t,...i){this.log("debug",e,t,...i)}info(e,t,...i){this.log("info",e,t,...i)}warn(e,t,...i){this.log("warn",e,t,...i)}error(e,t,...i){this.log("error",e,t,...i)}setLogLevel(e){this.level=e}setEnable(e){this.enable=e}log(e,t,i,...s){if(this.enable&&_.indexOf(e)>=_.indexOf(this.level)){let d=new Date().toISOString();(pe[e]??console.log)(`[${d}]  [${t}] [${e}]`,i,...s)}}},ce=new j({enable:!1,level:"error"}),r=ce;var he="ima:Ad",D=class{adId;adPodInfo;adSystem;advertiserName;apiFramework;companionAds;creativeAdId;creativeId;dealId;description;duration;height;mediaUrl;minSuggestedDuration;skipTimeOffset;surveyUrl;title;traffickingParameters;traffickingParametersString;uiElements;universalAdIdRegistry;universalAdIdValue;universalAdIds;vastMediaBitrate;vastMediaHeight;vastMediaWidth;width;wrapperAdIds;wrapperAdSystems;wrapperCreativeIds;linear;constructor(e,t,i,s){this.adId=e.id||"undefined",this.adPodInfo=s,this.adSystem=e.adSystem||"",this.advertiserName=e.advertiser||"",this.apiFramework=t.apiFramework||"",this.companionAds=[],this.creativeAdId=t.adId||"",this.creativeId=t.id||"",this.dealId="",this.description=e.description||"",this.duration=t.duration||0,this.height=0,this.mediaUrl=null,this.minSuggestedDuration=0,this.skipTimeOffset=t.skipDelay||-1,this.surveyUrl=null,this.title=e.adTitle||"",this.traffickingParameters={},this.traffickingParametersString="",this.uiElements=[],this.universalAdIdRegistry="",this.universalAdIdValue="",this.universalAdIds=[],this.vastMediaBitrate=0,this.vastMediaHeight=0,this.vastMediaWidth=0,this.width=0,this.wrapperAdIds=[],this.wrapperAdSystems=[],this.wrapperCreativeIds=[],this.linear=t.type==="linear"}getAdId(){return this.adId}getAdPodInfo(){return this.adPodInfo}getAdSystem(){return this.adSystem}getAdvertiserName(){return this.advertiserName}getApiFramework(){return this.apiFramework}getCompanionAds(e,t,i){return r.debug(he,`Ad adSlotWidth:[${e}] adSlotHeight[${t}] settings:`,i),this.companionAds}getCreativeAdId(){return this.creativeAdId}getCreativeId(){return this.creativeId}getDealId(){return this.dealId}getDescription(){return this.description}getDuration(){return this.duration}getHeight(){return this.height}getMediaUrl(){return this.mediaUrl}getMinSuggestedDuration(){return this.minSuggestedDuration}getSkipTimeOffset(){return this.skipTimeOffset}getSurveyUrl(){return this.surveyUrl}getTitle(){return this.title}getTraffickingParameters(){return this.traffickingParameters}getTraffickingParametersString(){return this.traffickingParametersString}getUiElements(){return this.uiElements}getUniversalAdIdRegistry(){throw new Error("Method not implemented.")}getUniversalAdIdValue(){return this.universalAdIdValue}getUniversalAdIds(){return this.universalAdIds}getVastMediaBitrate(){return this.vastMediaBitrate}getVastMediaHeight(){return this.vastMediaHeight}getVastMediaWidth(){return this.vastMediaWidth}getWidth(){return this.width}getWrapperAdIds(){return this.wrapperAdIds}getWrapperAdSystems(){return this.wrapperAdSystems}getWrapperCreativeIds(){return this.wrapperCreativeIds}isLinear(){return this.linear}};var I="ima:AdDisplayContainer",$=class{adContainer;videoElement;contentElement;adsContainerElement;adsSpinnerElement;videoAdsElement;constructor(e,t,i){this.adContainer=e,this.videoElement=t,this.contentElement=i}initialize(){r.debug(I,"initialize"),this.adsContainerElement||(this.adsContainerElement=this.createAdsContainer()),this.videoAdsElement||(this.videoAdsElement=this.createAdsVideoElement()),this.adsSpinnerElement||(this.adsSpinnerElement=this.createAdsSpinner())}destroy(){var e,t,i;r.debug(I,"destroy"),(e=this.videoAdsElement)==null||e.remove(),(t=this.adsSpinnerElement)==null||t.remove(),(i=this.adsContainerElement)==null||i.remove(),this.videoAdsElement=void 0}addEventListener(e,t,i){r.debug(I,`addEventListener [${e}] listener [${t}] useCapture [${i}]`)}removeEventListener(e,t,i){r.debug(I,`removeEventListener [${e}] listener [${t}] useCapture [${i}]`)}dispatchEvent(e){return r.debug(I,`dispatchEvent [${e}`),!0}getVideoAdsElement(){return this.videoAdsElement||this.videoElement}show(){let e=this.adsContainerElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}hide(){let e=this.adsContainerElement;e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0")}showLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="block")}hideLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="none")}hideAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.visibility="hidden",e.style.opacity="0")}showAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}clearAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="none",e.autoplay=!1,e.pause(),e.src="",e.load())}createAdsContainer(){let e=this.adContainer;if(!e)return;let t=document.getElementById("adm-adv-container")||document.createElement("div");return t.id="adm-adv-container",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.background="rgb(0,0,0)",t.style.display="none",e.appendChild(t),t}createAdsSpinner(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-adv-spinner")||document.createElement("div");t.id="adm-adv-spinner",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="40px",t.style.height="40px",t.style.border="5px solid #ccc",t.style.borderTop="5px solid #333",t.style.borderRadius="50%",t.style.zIndex="10",t.style.animation="adm-spinner-animation 1s linear infinite",t.style.display="none";let i=document.createElement("style");return i.textContent=`
      @keyframes adm-spinner-animation {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
    `,globalThis&&globalThis.document&&document.head.appendChild(i),e.appendChild(t),t}createAdsVideoElement(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-video-ads")||document.createElement("video");return t.id="adm-video-ads",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100%",t.style.height="100%",t.style.objectFit="cover",t.style.background="black",t.controls=!1,t.playsInline=!1,t.setAttribute("disablePictureInPicture",""),t.setAttribute("disableRemotePlayback",""),t.setAttribute("playsinline","false"),t.setAttribute("webkit-playsinline","false"),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("object","fit"),t.removeAttribute("controls"),e.appendChild(t),t}};var me=O,ve=x,S=class{static ErrorCode=me;static Type=ve;name;code;message;stack;cause;constructor(e,t){this.name="AdError",this.message=t,this.code=e}getErrorCode(){return this.code}getInnerError(){return new Error(this.message)}getMessage(){return this.message}getType(){return""}getVastErrorCode(){return this.code}};var fe=N,y=class l{static Type=fe;target;currentTarget;type=l.Type.AD_ERROR;adError;userRequestContext;constructor(e,t){this.adError=e,this.userRequestContext=t}getError(){return this.adError||null}getUserRequestContext(){return this.userRequestContext||null}preventDefault(){}stopPropagation(){}};var Ae=w,C=class l{static Type=Ae;currentTarget;target;type=l.Type.LOADED;ad=void 0;adData=null;constructor(e,t){this.type=e,this.ad=t}getAd(){return this.ad||null}getAdData(){return this.adData}preventDefault(){}stopPropagation(){}};var M=class{adPosition;isBumper;maxDuration;podIndex;timeOffset;totalAds;constructor(e,t,i,s,d,h){this.adPosition=e,this.isBumper=t,this.maxDuration=i,this.podIndex=s,this.timeOffset=d,this.totalAds=h}getAdPosition(){return this.adPosition}getIsBumper(){return this.isBumper}getMaxDuration(){return this.maxDuration}getPodIndex(){return this.podIndex}getTimeOffset(){return this.timeOffset}getTotalAds(){return this.totalAds}};var L=class{listeners={};addEventListener(e,t,i=!1,s=null){if(t===null)throw new Error("Handler cannot be null");this.listeners[e]||(this.listeners[e]=[]);let d=typeof t=="function"?t:t.handleEvent;if(typeof d!="function")throw new Error("Handler must be a function or have a handleEvent method");this.listeners[e].push({handler:d,scope:s,capture:i})}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>{i.handler.apply(i.scope,t)})}removeEventListener(e,t,i=!1){if(!this.listeners[e]||t===null)return;let s=typeof t=="function"?t:t.handleEvent;this.listeners[e]=this.listeners[e].filter(d=>d.handler!==s||d.capture!==i)}clearEventListeners(e){delete this.listeners[e]}clearAllEventListeners(){this.listeners={}}};var R=require("@dailymotion/vast-client"),ie=require("fast-xml-parser");var be=/^\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?$/;function q(l){if(l=="start")return 0;if(l=="end")return-1;if(be.test(l)){let[e="00",t="00",i="00"]=l.split(":"),s="00",d="000";return i.includes(".")?[s,d]=i.split("."):s=i,(parseInt(e,10)*3600+parseInt(t,10)*60+parseInt(s,10))*1e3+parseInt(d,10)}return parseFloat(l)}function ee(l){return new Promise((e,t)=>{l.preload="auto",l.load();let i=()=>{l.removeEventListener("canplay",i),e()},s=()=>{l.removeEventListener("error",s),t(new Error("Video failed to load"))};l.addEventListener("canplaythrough",i),l.addEventListener("error",s)})}var te=["play","pause","ended","waiting","stalled","canplay","playing","seeking","seeked","timeupdate","durationchange","loadedmetadata","suspend","abort"],Ee=500,v="ima:AdsManager",P=class{adsRequest;adDisplayContainer;adsRenderingSettings=void 0;vastTracker;content=void 0;eventEmitter;cuePoints;cueMapPoints;started=!1;nextAds=[];totalAds=0;totalTimeAds=0;currentPodIndex=0;canBeAdSkippable=!1;currentAdVast=void 0;currentAd=void 0;currentCreative=void 0;queueCreatives=[];processingAdv=!1;timerUpdateContentTime=void 0;adRemainingTime=-1;adDuration=-1;quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1};constructor(e,t){this.adsRequest=e,this.adDisplayContainer=t,this.eventEmitter=new L,this.content=void 0,this.cuePoints=[],this.cueMapPoints={},this.adsRenderingSettings=void 0,this.started=!1,this.processingAdv=!1,this.canBeAdSkippable=!1,this.adRemainingTime=-1,this.adDuration=-1,this.fetchAds=this.fetchAds.bind(this),this.attachContentMediaEventListeners=this.attachContentMediaEventListeners.bind(this),this.detachContentMediaEventListeners=this.detachContentMediaEventListeners.bind(this),this.handleContentTimeUpdate=this.handleContentTimeUpdate.bind(this),this.adsVideoEventsListener=this.adsVideoEventsListener.bind(this),this.adsVideoErrorListener=this.adsVideoErrorListener.bind(this)}collapse(){throw new Error("Method not implemented.")}configureAdsManager(e,t){this.content=e,this.adsRenderingSettings=t||void 0}destroy(){this.detachContentMediaEventListeners(),this.eventEmitter.clearAllEventListeners(),this.content=void 0,this.adsRenderingSettings=void 0}discardAdBreak(){}expand(){}focus(){}getAdSkippableState(){return this.canBeAdSkippable}getCuePoints(){return this.cuePoints}getRemainingTime(){return this.currentCreative?this.adRemainingTime:-1}getVolume(){return this.adDisplayContainer.getVideoAdsElement().volume}init(e,t,i,s){r.debug(v,`init width[${e}] height[${t}] viewMode[${i}] videoElement[${s}]`)}isCustomClickTrackingUsed(){return r.debug(v,"isCustomClickTrackingUsed"),!1}isCustomPlaybackUsed(){return r.debug(v,"isCustomPlaybackUsed"),!0}pause(){r.debug(v,"pause")}resize(e,t,i){r.debug(v,`resize width[${e}] height[${t}] viewMode[${i}]`)}resume(){r.debug(v,"resume")}setVolume(e){let t=this.adDisplayContainer.getVideoAdsElement();t&&(t.volume=e)}skip(){var i,s;let e=this.adDisplayContainer.getVideoAdsElement(),t=((i=this.currentCreative)==null?void 0:i.skipDelay)||0;if(!(!e||t<=0||this.adRemainingTime>t&&this.adRemainingTime<this.adDuration))try{e.pause()}finally{r.debug(v,"video user skipped"),(s=this.vastTracker)==null||s.skip(),this.dispatchAdsEvent(google.ima.AdEvent.Type.SKIPPED),this.playCreativities()}}start(){this.started||(this.started=!0,this.cuePoints.length>0?(this.fetchVastAds(0),this.attachContentMediaEventListeners()):this.playCreativities())}stop(){this.started=!1}updateAdsRenderingSettings(e){r.debug(v,`updateAdsRenderingSettings [${e}]`)}addEventListener(e,t,i,s){this.eventEmitter.addEventListener(e,t,i,s)}removeEventListener(e,t,i,s){this.eventEmitter.removeEventListener(e,t,i)}dispatchEvent(e){return r.debug(v,`dispatchEvent: [${e}]`),!0}fetchAds(){let e=this.adsRequest.adTagUrl;return fetch(e).then(t=>t.text()).then(async t=>{var d;let i=new ie.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#text"}),s=i.parse(t);if(!s)return Promise.reject(new Error("Invalid XML response"));if(s.VAST){let h=new globalThis.DOMParser().parseFromString(t,"text/xml"),o=await new R.VASTParser().parseVAST(h),m=[],A=0,f=0;r.debug(v,`fetchVastAds: [${e}]: `,o);let b=(o==null?void 0:o.ads)??void 0;if(b&&b.length>0)for(let E of b){let T=this.getAdValidCreative(E);T&&(m.push(E),A+=T.duration||0,f+=1)}else(d=o.errorURLTemplates)==null||d.forEach(E=>{this.trackUrl(E)});this.nextAds=m,this.totalAds=f,this.totalTimeAds=A,r.debug(v,`fetchVastAds totalAds: [${f}] [${A}]`)}else{let h=i.parse(t),c=h==null?void 0:h["vmap:VMAP"]["vmap:AdBreak"];if(!c)return this;if(Array.isArray(c))c.forEach(o=>{let m=o["@_timeOffset"];if(m){let A=q(m);if(!isNaN(A)&&this.isValidAdBreak(o)){r.debug(v,`vmap adBreak timeOffset [${m}]:`,A),this.cuePoints.includes(A)||this.cuePoints.push(A);let f=this.cueMapPoints[A]||[];f.push(o),this.cueMapPoints[A]=f}}});else{let o=c["@_timeOffset"];if(o){let m=q(o);!isNaN(m)&&this.isValidAdBreak(c)&&(this.cuePoints.push(m),this.cueMapPoints[m]=[c])}}}return this.adDisplayContainer.initialize(),this}).catch(t=>Promise.reject(t))}isValidContentObject(e){return!!e&&(e instanceof HTMLVideoElement||"currentTime"in e)}allAdsCompleted(){var e,t,i;this.removeVideoListeners(),this.cuePoints.length===0&&this.dispatchAdsEvent(google.ima.AdEvent.Type.ALL_ADS_COMPLETED),this.nextAds=[],this.queueCreatives=[],this.vastTracker=void 0,this.currentAdVast=void 0,this.currentAd=void 0,this.currentCreative=void 0,this.adRemainingTime=-1,this.canBeAdSkippable=!1,(e=this.adDisplayContainer)==null||e.hideAdVideoElement(),(t=this.adDisplayContainer)==null||t.clearAdVideoElement(),(i=this.adDisplayContainer)==null||i.hide(),this.processingAdv=!1,this.dispatchAdsEvent(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED)}playCreativities(){this.processingAdv=!0;let e=!!this.currentAd;if(this.currentCreative=void 0,this.currentAdVast&&this.queueCreatives.length>0){let i=this.queueCreatives.shift();if(!i)return this.playCreativities();let s=i.mediaFiles;if(s&&s.length>0)for(let d of s){let h=d.mimeType;if(h&&h.startsWith("video/mp4")&&d.fileURL){this.currentCreative=i,this.vastTracker=new R.VASTTracker(null,this.currentAdVast,this.currentCreative);let c=this.totalAds-this.nextAds.length,o=new M(c,!1,this.totalTimeAds,this.currentPodIndex,0,this.totalAds);r.debug(v,`current podInfo: [${c}] [${this.totalTimeAds}] [${this.totalAds}]`),this.currentAd=new D(this.currentAdVast,i,d,o),e||this.dispatchAdsEvent(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED),this.playAdsContent(d.fileURL).catch(m=>{r.error(v,"playAdsContent error: ",m)});return}}return this.playCreativities()}if(!this.nextAds||this.nextAds.length===0){this.allAdsCompleted();return}let t=this.nextAds.shift();return t?(this.currentAdVast=t,this.queueCreatives=this.getCreativities(t),this.playCreativities()):this.playCreativities()}handleContentTimeUpdate(){let e=this.content;if(!this.isValidContentObject(e)||this.cuePoints.length===0||this.processingAdv)return;if(this.nextAds&&this.nextAds.length>0){this.processingAdv=!0,this.playCreativities();return}let t=e.currentTime*1e3;r.debug(v,`Content current time: [${t}]`);let i=this.cuePoints.find(s=>Math.abs(s-t)<=Ee);i&&(r.debug(v,`fetchVastAds: [${i}]`),this.fetchVastAds(i))}clearTimerUpdateContentTime(){clearTimeout(this.timerUpdateContentTime)}startTimerUpdateContentTime(){var t;let e=(((t=globalThis.navigator)==null?void 0:t.hardwareConcurrency)||0)<=2?500:300;this.clearTimerUpdateContentTime(),this.timerUpdateContentTime=setTimeout(()=>{this.handleContentTimeUpdate(),this.startTimerUpdateContentTime()},e)}attachContentMediaEventListeners(){let e=this.content;e&&(e instanceof HTMLVideoElement?e.addEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.startTimerUpdateContentTime())}detachContentMediaEventListeners(){let e=this.content;e&&(e instanceof HTMLVideoElement?e.removeEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.clearTimerUpdateContentTime())}isValidAdBreak(e){var s,d;let t=e["vmap:AdSource"];return!(!t||!((d=(s=t["vmap:AdTagURI"])==null?void 0:s["#text"])==null?void 0:d.trim()))}getAdValidCreative(e){let t=e.creatives;if(t&&t.length>0){for(let i of t)if(i.type==="linear"){let h=i.mediaFiles;if(h&&h.length>0)for(let c of h){let o=(c.mimeType||"").toLowerCase();if(o&&o==="video/mp4"&&c.fileURL)return i}}}}getCreativities(e){let t=[],i=e.creatives;if(i&&i.length>0){for(let s of i)if(s.type==="linear"){let c=s.mediaFiles;if(c&&c.length>0)for(let o of c){let m=o.mimeType;if(m&&m.startsWith("video/mp4")&&o.fileURL){t.push(s);break}}}}return t}trackingEvent(e){let t=this.currentCreative;if(!t)return;let i=t.trackingEvents,s=i==null?void 0:i[e];if(s)for(let d of s)this.trackUrl(d)}trackUrl(e){try{if(globalThis){let t=new globalThis.Image;t.src=e}}catch(t){r.error(v,`trackUrl [${e}] error: `,t)}}getPromiseVastClient(e){return new R.VASTClient().get(e)}async fetchVastAds(e){var t,i,s;if(this.started)try{this.currentPodIndex=e;let d=this.cueMapPoints[e];delete this.cueMapPoints[e];let h=[],c=0,o=0;if(d){let m=[];for(let f of d){let b=f["vmap:AdSource"];if(b){let E=(i=(t=b["vmap:AdTagURI"])==null?void 0:t["#text"])==null?void 0:i.trim();E&&h.push(this.getPromiseVastClient(E))}}let A=await Promise.allSettled(h);for(let f of A)if(f.status==="fulfilled"){let b=f.value,E=(b==null?void 0:b.ads)??void 0;if(E&&E.length>0)for(let T of E){let K=this.getAdValidCreative(T);K&&(m.push(T),c+=K.duration||0,o+=1)}else(s=b.errorURLTemplates)==null||s.forEach(T=>{this.trackUrl(T)})}this.nextAds=m,this.totalAds=o,this.totalTimeAds=c,r.debug(v,`fetchVastAds totalAds: [${o}] [${c}]`),!this.nextAds||this.nextAds.length===0?this.allAdsCompleted():this.playCreativities()}else this.allAdsCompleted()}catch(d){r.error(v,"fetchVastAds error:",d)}}dispatchAdsEvent(e){r.debug(v,"dispatchAdsEvent: ",e),this.eventEmitter.emit(e,new C(e,this.currentAd))}adsVideoEventsListener(e){var i,s,d,h;let t=this.adDisplayContainer.getVideoAdsElement();if(t)switch(e.type){case"loadstart":{this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_BREAK_READY);break}case"durationchange":{let c=t.duration;((i=this.currentAd)==null?void 0:i.getDuration())!==c&&this.dispatchAdsEvent(google.ima.AdEvent.Type.DURATION_CHANGE);break}case"canplay":{this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_CAN_PLAY);break}case"loadedmetadata":{this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_METADATA);break}case"play":{this.quartilesFired.start?this.dispatchAdsEvent(google.ima.AdEvent.Type.RESUMED):(this.quartilesFired.start=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.STARTED));break}case"pause":{this.dispatchAdsEvent(google.ima.AdEvent.Type.PAUSED);break}case"timeupdate":{let c=t.duration||-1;if(!isNaN(c)&&c>=0){let o=t.currentTime||0,m=o/c,A=c-o,f=((s=this.currentCreative)==null?void 0:s.skipDelay)||0;this.adRemainingTime=A,this.adDuration=c,r.debug(v,`video adv currentTime: ${o}, Percentage: ${m}%, SkipDelay: ${f}`),this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.STARTED)),!this.quartilesFired.firstQuartile&&m>=.25&&(this.quartilesFired.firstQuartile=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.FIRST_QUARTILE)),!this.quartilesFired.midpoint&&m>=.5&&(this.quartilesFired.midpoint=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.MIDPOINT)),!this.quartilesFired.thirdQuartile&&m>=.75&&(this.quartilesFired.thirdQuartile=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.THIRD_QUARTILE)),this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_PROGRESS),(d=this.vastTracker)==null||d.setProgress(o),!this.canBeAdSkippable&&f>0&&o>=f&&(this.canBeAdSkippable=!0,r.debug(v,`video adv can be skippable: [${o}] [${c}] [${f}]`),this.dispatchAdsEvent(google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED))}break}case"ended":{this.adRemainingTime=-1,this.adDuration=-1,this.quartilesFired.complete||(this.quartilesFired.complete=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.COMPLETE)),(h=this.vastTracker)==null||h.complete(),this.playCreativities();break}}}adsVideoErrorListener(e){var t,i;r.error(v,"adsVideoErrorListener: ",e),(t=this.adDisplayContainer)==null||t.hideAdVideoElement(),(i=this.adDisplayContainer)==null||i.clearAdVideoElement(),this.playCreativities()}resetQuartilesFired(){this.quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1}}async playAdsContent(e){var i,s,d,h,c,o;let t=this.adDisplayContainer.getVideoAdsElement();if(!t)return r.error(v,"playAdsContent no Video Ads Element: "),this.playCreativities();this.adRemainingTime=-1,this.adDuration=-1,this.canBeAdSkippable=!1,this.resetQuartilesFired(),this.removeVideoListeners(),(i=this.adDisplayContainer)==null||i.show(),(s=this.adDisplayContainer)==null||s.showLoader(),(d=this.adDisplayContainer)==null||d.hideAdVideoElement(),t.src=e,t.autoplay=!0;try{await ee(t),await t.play(),this.addVideoListeners(),(h=this.adDisplayContainer)==null||h.showAdVideoElement(),(c=this.adDisplayContainer)==null||c.hideLoader(),this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_CAN_PLAY)}catch(m){r.error(v,"playAdsContent error: ",m),this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_BREAK_FETCH_ERROR),(o=this.adDisplayContainer)==null||o.hideAdVideoElement(),this.playCreativities()}finally{this.adDisplayContainer.hideLoader()}}addVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(te.forEach(t=>e.addEventListener(t,this.adsVideoEventsListener)),e.addEventListener("error",this.adsVideoErrorListener))}removeVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(te.forEach(t=>e.removeEventListener(t,this.adsVideoEventsListener)),e.removeEventListener("error",this.adsVideoErrorListener))}};var Te=U,k=class{static Type=Te;currentTarget;target;type;adsManager;constructor(e){this.adsManager=e,this.currentTarget=null,this.target=null,this.type="adsManagerLoaded"}getAdsManager(e,t){return this.adsManager.configureAdsManager(e,t),this.adsManager}getUserRequestContext(){throw new Error("Method not implemented.")}preventDefault(){throw new Error("Method not implemented.")}stopPropagation(){throw new Error("Method not implemented.")}};var ne="ima:AdsLoader",G=class{adDisplayContainer;adsManager=void 0;eventEmitter;userRequestContext=void 0;imaSdkSettings=new g;constructor(e){this.adDisplayContainer=e,this.eventEmitter=new L}addEventListener(e,t,i,s){this.eventEmitter.addEventListener(e,t,i,s)}contentComplete(){}dispatchEvent(e){return r.debug(ne,"dispatchEvent",e),!0}getSettings(){return this.imaSdkSettings}getVersion(){return"custom"}removeEventListener(e,t,i,s){this.eventEmitter.removeEventListener(e,t,i)}requestAds(e,t){if(this.userRequestContext=t||void 0,!e.adTagUrl){let s=new S(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,"AdManager is already defined or adTagUrl is not defined");this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new y(s));return}this.adsManager=new P(e,this.adDisplayContainer),this.adsManager.fetchAds().then(s=>(this.adsManager=s,this.eventEmitter.emit(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,new k(s)))).catch(s=>{let d=s.message||"Unable to retrive vmap files",h=new S(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,s.message||"Unable to retrive vmap files");return r.error(ne,d,h),this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new y(h))})}destroy(){var e;(e=this.adsManager)==null||e.destroy(),this.adDisplayContainer.destroy(),this.eventEmitter.clearAllEventListeners()}};var W=class{autoAlign=!1;bitrate=-1;enablePreloading=!1;loadVideoTimeout=-1;mimeTypes=null;playAdsAfterTime=0;restoreCustomPlaybackStateOnAdBreakComplete=!1;uiElements=null;useStyledLinearAds=!0;useStyledNonLinearAds=!1};var Q="ima:AdsRequest",Y=class{adTagUrl;adsResponse;contentDuration;contentKeywords;contentTitle;forceNonLinearFullSlot;linearAdSlotHeight;linearAdSlotWidth;liveStreamPrefetchSeconds;nonLinearAdSlotHeight;nonLinearAdSlotWidth;omidAccessModeRules;pageUrl;vastLoadTimeout;constructor(){this.adTagUrl="",this.adsResponse=null,this.contentDuration=null,this.contentKeywords=null,this.contentTitle=null,this.forceNonLinearFullSlot=!1,this.linearAdSlotHeight=0,this.linearAdSlotWidth=0,this.liveStreamPrefetchSeconds=0,this.nonLinearAdSlotHeight=0,this.nonLinearAdSlotWidth=0,this.omidAccessModeRules={},this.pageUrl=null,this.vastLoadTimeout=0}setAdWillAutoPlay(e){r.debug(Q,`setAdWillAutoPlay [${e}]`)}setAdWillPlayMuted(e){r.debug(Q,`setAdWillPlayMuted [${e}]`)}setContinuousPlayback(e){r.debug(Q,`setContinuousPlayback [${e}]`)}};var ge=H;function Se(l,e="debug"){r.setEnable(l),r.setLogLevel(e)}var ye=z;0&&(module.exports={Ad,AdDisplayContainer,AdError,AdErrorEvent,AdEvent,AdPodInfo,AdsLoader,AdsManager,AdsManagerLoadedEvent,AdsRenderingSettings,AdsRequest,ImaSdkSettings,VERSION,ViewMode,activateDebug,settings});
/* Built on 2025-05-19T19:35:41.139Z */
