"use strict";function e(e,t){if(t==null||t>e.length)t=e.length;for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function t(e){if(Array.isArray(e))return e}function i(t){if(Array.isArray(t))return e(t)}function n(e,t,i,n,r,a,s){try{var o=e[a](s);var u=o.value}catch(e){i(e);return}if(o.done){t(u)}else{Promise.resolve(u).then(n,r)}}function r(e){return function(){var t=this,i=arguments;return new Promise(function(r,a){var s=e.apply(t,i);function o(e){n(s,r,a,o,u,"next",e)}function u(e){n(s,r,a,o,u,"throw",e)}o(undefined)})}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function o(e,t,i){if(t)s(e.prototype,t);if(i)s(e,i);return e}function u(e,t){if(t!=null&&typeof Symbol!=="undefined"&&t[Symbol.hasInstance]){return!!t[Symbol.hasInstance](e)}else{return e instanceof t}}function l(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function d(e,t){var i=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(i==null)return;var n=[];var r=true;var a=false;var s,o;try{for(i=i.call(e);!(r=(s=i.next()).done);r=true){n.push(s.value);if(t&&n.length===t)break}}catch(e){a=true;o=e}finally{try{if(!r&&i["return"]!=null)i["return"]()}finally{if(a)throw o}}return n}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e,i){return t(e)||d(e,i)||p(e,i)||h()}function f(e){return i(e)||l(e)||p(e)||c()}function y(e){"@swc/helpers - typeof";return e&&typeof Symbol!=="undefined"&&e.constructor===Symbol?"symbol":typeof e}function p(t,i){if(!t)return;if(typeof t==="string")return e(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,i)}function m(e,t){var i,n,r,a={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},s=Object.create((typeof Iterator==="function"?Iterator:Object).prototype);return s.next=o(0),s["throw"]=o(1),s["return"]=o(2),typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(e){return function(t){return u([e,t])}}function u(o){if(i)throw new TypeError("Generator is already executing.");while(s&&(s=0,o[0]&&(a=0)),a)try{if(i=1,n&&(r=o[0]&2?n["return"]:o[0]?n["throw"]||((r=n["return"])&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;if(n=0,r)o=[o[0]&2,r.value];switch(o[0]){case 0:case 1:r=o;break;case 4:a.label++;return{value:o[1],done:false};case 5:a.label++;n=o[1];o=[0];continue;case 7:o=a.ops.pop();a.trys.pop();continue;default:if(!(r=a.trys,r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){a=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(o[0]===6&&a.label<r[1]){a.label=r[1];r=o;break}if(r&&a.label<r[2]){a.label=r[2];a.ops.push(o);break}if(r[2])a.ops.pop();a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e];n=0}finally{i=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}}var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var C=function(e,t,i){return t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i};var b=function(e,t){for(var i in t)g(e,i,{get:t[i],enumerable:!0})},T=function(e,t,i,n){var r=true,a=false,s=undefined;if(t&&(typeof t==="undefined"?"undefined":y(t))=="object"||typeof t=="function")try{var o=function(){var r=l.value;!k.call(e,r)&&r!==i&&g(e,r,{get:function(){return t[r]},enumerable:!(n=A(t,r))||n.enumerable})};for(var u=E(t)[Symbol.iterator](),l;!(r=(l=u.next()).done);r=true)o()}catch(e){a=true;s=e}finally{try{if(!r&&u.return!=null){u.return()}}finally{if(a){throw s}}}return e};var S=function(e){return T(g({},"__esModule",{value:!0}),e)};var w=function(e,t,i){return C(e,(typeof t==="undefined"?"undefined":y(t))!="symbol"?t+"":t,i)};var L={};b(L,{Ad:function(){return P},AdDisplayContainer:function(){return x},AdError:function(){return N},AdErrorEvent:function(){return B},AdEvent:function(){return F},AdPodInfo:function(){return q},AdsLoader:function(){return Z},AdsManager:function(){return X},AdsManagerLoadedEvent:function(){return J},AdsRenderingSettings:function(){return ee},AdsRequest:function(){return et},ImaSdkSettings:function(){return _},ViewMode:function(){return en},activateDebug:function(){return ei},settings:function(){return I}});module.exports=S(L);var _;(function(e){var t;(function(e){return e.ALWAYS="always",e.ON_MASTER_AD="on_master_ad"})(t=e.CompanionBackfillMode||(e.CompanionBackfillMode={}));var i;(function(e){return e[e.DISABLED=0]="DISABLED",e[e.ENABLED=1]="ENABLED",e[e.INSECURE=2]="INSECURE"})(i=e.VpaidMode||(e.VpaidMode={}));var n=/*#__PURE__*/function(){function e(){a(this,e)}o(e,[{key:"getCompanionBackfill",value:function e(){return"always"}},{key:"getDisableCustomPlaybackForIOS10Plus",value:function e(){return!0}},{key:"getFeatureFlags",value:function e(){return{}}},{key:"getLocale",value:function e(){return""}},{key:"getNumRedirects",value:function e(){return-1}},{key:"getPlayerType",value:function e(){return"lib"}},{key:"getPlayerVersion",value:function e(){return"1.0.0"}},{key:"getPpid",value:function e(){return""}},{key:"isCookiesEnabled",value:function e(){return!1}},{key:"setAutoPlayAdBreaks",value:function e(e){}},{key:"setCompanionBackfill",value:function e(){}},{key:"setCookiesEnabled",value:function e(e){}},{key:"setDisableCustomPlaybackForIOS10Plus",value:function e(e){}},{key:"setFeatureFlags",value:function e(e){}},{key:"setLocale",value:function e(e){}},{key:"setNumRedirects",value:function e(e){}},{key:"setPlayerType",value:function e(e){}},{key:"setPlayerVersion",value:function e(e){}},{key:"setPpid",value:function e(e){}},{key:"setSessionId",value:function e(e){}},{key:"setVpaidAllowed",value:function e(e){}},{key:"setVpaidMode",value:function e(e){}}]);return e}();e.ImaSdkSettings=n})(_||(_={}));var I=new _.ImaSdkSettings;var P=/*#__PURE__*/function(){function e(t,i,n,r){a(this,e);w(this,"adId");w(this,"adPodInfo");w(this,"adSystem");w(this,"advertiserName");w(this,"apiFramework");w(this,"companionAds");w(this,"creativeAdId");w(this,"creativeId");w(this,"dealId");w(this,"description");w(this,"duration");w(this,"height");w(this,"mediaUrl");w(this,"minSuggestedDuration");w(this,"skipTimeOffset");w(this,"surveyUrl");w(this,"title");w(this,"traffickingParameters");w(this,"traffickingParametersString");w(this,"uiElements");w(this,"universalAdIdRegistry");w(this,"universalAdIdValue");w(this,"universalAdIds");w(this,"vastMediaBitrate");w(this,"vastMediaHeight");w(this,"vastMediaWidth");w(this,"width");w(this,"wrapperAdIds");w(this,"wrapperAdSystems");w(this,"wrapperCreativeIds");w(this,"linear");this.adId=t.id||"undefined",this.adPodInfo=r,this.adSystem=t.adSystem||"",this.advertiserName=t.advertiser||"",this.apiFramework=i.apiFramework||"",this.companionAds=[],this.creativeAdId=i.adId||"",this.creativeId=i.id||"",this.dealId="",this.description=t.description||"",this.duration=i.duration||0,this.height=0,this.mediaUrl=null,this.minSuggestedDuration=0,this.skipTimeOffset=i.skipDelay||-1,this.surveyUrl=null,this.title=t.adTitle||"",this.traffickingParameters={},this.traffickingParametersString="",this.uiElements=[],this.universalAdIdRegistry="",this.universalAdIdValue="",this.universalAdIds=[],this.vastMediaBitrate=0,this.vastMediaHeight=0,this.vastMediaWidth=0,this.width=0,this.wrapperAdIds=[],this.wrapperAdSystems=[],this.wrapperCreativeIds=[],this.linear=i.type==="linear"}o(e,[{key:"getAdId",value:function e(){return this.adId}},{key:"getAdPodInfo",value:function e(){return this.adPodInfo}},{key:"getAdSystem",value:function e(){return this.adSystem}},{key:"getAdvertiserName",value:function e(){return this.advertiserName}},{key:"getApiFramework",value:function e(){return this.apiFramework}},{key:"getCompanionAds",value:function e(e,t,i){return this.companionAds}},{key:"getCreativeAdId",value:function e(){return this.creativeAdId}},{key:"getCreativeId",value:function e(){return this.creativeId}},{key:"getDealId",value:function e(){return this.dealId}},{key:"getDescription",value:function e(){return this.description}},{key:"getDuration",value:function e(){return this.duration}},{key:"getHeight",value:function e(){return this.height}},{key:"getMediaUrl",value:function e(){return this.mediaUrl}},{key:"getMinSuggestedDuration",value:function e(){return this.minSuggestedDuration}},{key:"getSkipTimeOffset",value:function e(){return this.skipTimeOffset}},{key:"getSurveyUrl",value:function e(){return this.surveyUrl}},{key:"getTitle",value:function e(){return this.title}},{key:"getTraffickingParameters",value:function e(){return this.traffickingParameters}},{key:"getTraffickingParametersString",value:function e(){return this.traffickingParametersString}},{key:"getUiElements",value:function e(){return this.uiElements}},{key:"getUniversalAdIdRegistry",value:function e(){throw new Error("Method not implemented.")}},{key:"getUniversalAdIdValue",value:function e(){return this.universalAdIdValue}},{key:"getUniversalAdIds",value:function e(){return this.universalAdIds}},{key:"getVastMediaBitrate",value:function e(){return this.vastMediaBitrate}},{key:"getVastMediaHeight",value:function e(){return this.vastMediaHeight}},{key:"getVastMediaWidth",value:function e(){return this.vastMediaWidth}},{key:"getWidth",value:function e(){return this.width}},{key:"getWrapperAdIds",value:function e(){return this.wrapperAdIds}},{key:"getWrapperAdSystems",value:function e(){return this.wrapperAdSystems}},{key:"getWrapperCreativeIds",value:function e(){return this.wrapperCreativeIds}},{key:"isLinear",value:function e(){return this.linear}}]);return e}();var D=["debug","info","warn","error","fatal","trace"],R={debug:console.debug||console.log,info:console.info||console.log,warn:console.warn||console.log,error:console.error||console.log,fatal:console.error||console.log,trace:console.trace||console.log},M=/*#__PURE__*/function(){function e(t){a(this,e);w(this,"enable");w(this,"level");this.enable=t.enable||!1,this.level=t.level||"info"}o(e,[{key:"debug",value:function e(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++){n[r-2]=arguments[r]}this.log.apply(this,["debug",e,t].concat(f(n)))}},{key:"info",value:function e(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++){n[r-2]=arguments[r]}this.log.apply(this,["info",e,t].concat(f(n)))}},{key:"warn",value:function e(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++){n[r-2]=arguments[r]}this.log.apply(this,["warn",e,t].concat(f(n)))}},{key:"error",value:function e(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++){n[r-2]=arguments[r]}this.log.apply(this,["error",e,t].concat(f(n)))}},{key:"setLogLevel",value:function e(e){this.level=e}},{key:"setEnable",value:function e(e){this.enable=e}},{key:"log",value:function e(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++){r[a-3]=arguments[a]}if(this.enable&&D.indexOf(e)>=D.indexOf(this.level)){var s=new Date().toISOString();var o;((o=R[e])!==null&&o!==void 0?o:console.log).apply(this,["[".concat(t,"][").concat(e,"]"),i].concat(f(r)))}}}]);return e}(),U=new M({enable:!1,level:"error"}),V=U;var O="ima:AdDisplayContainer",x=/*#__PURE__*/function(){function e(t,i,n){a(this,e);w(this,"adContainer");w(this,"videoElement");w(this,"contentElement");w(this,"adsContainerElement");w(this,"adsSpinnerElement");w(this,"videoAdsElement");this.adContainer=t,this.videoElement=i,this.contentElement=n}o(e,[{key:"initialize",value:function e(){V.debug(O,"initialize"),this.adsContainerElement||(this.adsContainerElement=this.createAdsContainer()),this.videoAdsElement||(this.videoAdsElement=this.createAdsVideoElement()),this.adsSpinnerElement||(this.adsSpinnerElement=this.createAdsSpinner())}},{key:"destroy",value:function e(){var e,t,i;V.debug(O,"destroy"),(e=this.videoAdsElement)===null||e===void 0?void 0:e.remove(),(t=this.adsSpinnerElement)===null||t===void 0?void 0:t.remove(),(i=this.adsContainerElement)===null||i===void 0?void 0:i.remove(),this.videoAdsElement=void 0}},{key:"addEventListener",value:function e(e,t,i){}},{key:"removeEventListener",value:function e(e,t,i){}},{key:"dispatchEvent",value:function e(e){return!0}},{key:"getVideoAdsElement",value:function e(){return this.videoAdsElement||this.videoElement}},{key:"show",value:function e(){var e=this.adsContainerElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}},{key:"hide",value:function e(){var e=this.adsContainerElement;e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0")}},{key:"showLoader",value:function e(){var e=this.adsSpinnerElement;e&&(e.style.visibility="block")}},{key:"hideLoader",value:function e(){var e=this.adsSpinnerElement;e&&(e.style.visibility="none")}},{key:"createAdsContainer",value:function e(){var e=this.adContainer;if(!e)return;var t=document.getElementById("adm-adv-container")||document.createElement("div");return t.id="adm-adv-container",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgb(0,0,0)",t.style.display="none",e.appendChild(t),t}},{key:"createAdsSpinner",value:function e(){var e=this.adsContainerElement;if(!e)return;var t=document.getElementById("adm-adv-spinner")||document.createElement("div");t.id="adm-adv-spinner",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="40px",t.style.height="40px",t.style.border="5px solid #ccc",t.style.borderTop="5px solid #333",t.style.borderRadius="50%",t.style.zIndex="10",t.style.animation="adm-spinner-animation 1s linear infinite",t.style.display="none";var i=document.createElement("style");return i.textContent="\n      @keyframes adm-spinner-animation {\n        0% { transform: translate(-50%, -50%) rotate(0deg); }\n        100% { transform: translate(-50%, -50%) rotate(360deg); }\n      }\n    ",globalThis&&globalThis.document&&document.head.appendChild(i),e.appendChild(t),t}},{key:"createAdsVideoElement",value:function e(){var e=this.adsContainerElement;if(!e)return;var t=document.getElementById("adm-video-ads")||document.createElement("video");return t.id="adm-video-ads",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.controls=!1,t.playsInline=!1,t.setAttribute("disablePictureInPicture",""),t.setAttribute("disableRemotePlayback",""),t.setAttribute("playsinline","false"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("object","fit"),t.removeAttribute("controls"),e.appendChild(t),t}}]);return e}();var N=/*#__PURE__*/function(){function e(t,i){a(this,e);w(this,"name");w(this,"code");w(this,"message");w(this,"stack");w(this,"cause");this.name="AdError",this.message=i,this.code=t}o(e,[{key:"getErrorCode",value:function e(){return this.code}},{key:"getInnerError",value:function e(){return new Error(this.message)}},{key:"getMessage",value:function e(){throw this.message}},{key:"getType",value:function e(){throw""}},{key:"getVastErrorCode",value:function e(){throw this.code}}]);return e}();var B;(function(e){var t;(function(e){return e.AD_ERROR="adError"})(t=e.Type||(e.Type={}));var i=/*#__PURE__*/function(){function e(){a(this,e);w(this,"target");w(this,"currentTarget");w(this,"type","adError")}o(e,[{key:"getError",value:function e(){return null}},{key:"getUserRequestContext",value:function e(){return null}},{key:"preventDefault",value:function e(){}},{key:"stopPropagation",value:function e(){}}]);return e}();e.AdErrorEvent=i})(B||(B={}));var F;(function(e){var t;(function(e){return e.AD_BREAK_FETCH_ERROR="adBreakFetchError",e.AD_BREAK_READY="adBreakReady",e.AD_BUFFERING="adBuffering",e.AD_CAN_PLAY="adCanPlay",e.AD_METADATA="adMetadata",e.AD_PROGRESS="adProgress",e.ALL_ADS_COMPLETED="allAdsCompleted",e.CLICK="click",e.COMPLETE="complete",e.CONTENT_PAUSE_REQUESTED="contentPauseRequested",e.CONTENT_RESUME_REQUESTED="contentResumeRequested",e.DURATION_CHANGE="durationChange",e.FIRST_QUARTILE="firstquartile",e.IMPRESSION="impression",e.INTERACTION="interaction",e.LINEAR_CHANGED="linearChanged",e.LOADED="loaded",e.LOG="log",e.MIDPOINT="midpoint",e.PAUSED="pause",e.RESUMED="resume",e.SKIPPABLE_STATE_CHANGED="skippableStateChanged",e.SKIPPED="skipped",e.STARTED="start",e.THIRD_QUARTILE="thirdquartile",e.USER_CLOSE="userClose",e.VIDEO_CLICKED="videoClicked",e.VIDEO_ICON_CLICKED="videoIconClicked",e.VOLUME_CHANGED="volumeChanged",e.VOLUME_MUTED="volumeMuted"})(t=e.Type||(e.Type={}));var i=/*#__PURE__*/function(){function e(t,i){a(this,e);w(this,"currentTarget");w(this,"target");w(this,"type","loaded");w(this,"ad");w(this,"adData",null);this.type=t,this.ad=i}o(e,[{key:"getAd",value:function e(){return this.ad||null}},{key:"getAdData",value:function e(){return this.adData}},{key:"preventDefault",value:function e(){}},{key:"stopPropagation",value:function e(){}}]);return e}();e.AdEvent=i})(F||(F={}));var q=/*#__PURE__*/function(){function e(t,i,n,r,s,o){a(this,e);w(this,"adPosition");w(this,"isBumper");w(this,"maxDuration");w(this,"podIndex");w(this,"timeOffset");w(this,"totalAds");this.adPosition=t,this.isBumper=i,this.maxDuration=n,this.podIndex=r,this.timeOffset=s,this.totalAds=o}o(e,[{key:"getAdPosition",value:function e(){return this.adPosition}},{key:"getIsBumper",value:function e(){return this.isBumper}},{key:"getMaxDuration",value:function e(){return this.maxDuration}},{key:"getPodIndex",value:function e(){return this.podIndex}},{key:"getTimeOffset",value:function e(){return this.timeOffset}},{key:"getTotalAds",value:function e(){return this.totalAds}}]);return e}();var H=/*#__PURE__*/function(){function e(){a(this,e);w(this,"listeners",{})}o(e,[{key:"addEventListener",value:function e(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(t===null)throw new Error("Handler cannot be null");this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({handler:u(t,Function)?t:t===null||t===void 0?void 0:t.handleEvent,scope:n,capture:i})}},{key:"emit",value:function e(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++){i[n-1]=arguments[n]}this.listeners[e]&&this.listeners[e].forEach(function(e){e.handler.apply(e.scope,i)})}},{key:"removeEventListener",value:function e(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(function(e){return e.handler!==(u(t,Function)?t:t===null||t===void 0?void 0:t.handleEvent)||e.capture!==i}))}},{key:"clearEventListeners",value:function e(e){this.listeners[e]&&delete this.listeners[e]}},{key:"clearAllEventListeners",value:function e(){this.listeners={}}}]);return e}();var Q=require("@dailymotion/vast-client"),W=require("fast-xml-parser");var j=/^\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?$/;function K(e){if(e=="start"||e=="end")return 0;if(j.test(e)){var t=v(e.split(":"),3),i=t[0],n=i===void 0?"00":i,r=t[1],a=r===void 0?"00":r,s=t[2],o=s===void 0?"00":s,u="00",l="000";var d;return o.includes(".")?(d=v(o.split("."),2),u=d[0],l=d[1],d):u=o,(parseInt(n,10)*3600+parseInt(a,10)*60+parseInt(u,10))*1e3+parseInt(l,10)}return parseFloat(e)}function G(e){return new Promise(function(t,i){e.preload="auto",e.load();var n=function(){e.removeEventListener("canplay",n),t()},r=function(){e.removeEventListener("error",r),i(new Error("Video failed to load"))};e.addEventListener("canplaythrough",n),e.addEventListener("error",r)})}var z=["play","pause","ended","waiting","stalled","canplay","playing","seeking","seeked","timeupdate","durationchange","loadedmetadata","suspend","abort"],Y=500,$="ima:AdsManager",X=/*#__PURE__*/function(){function e(t,i){a(this,e);w(this,"adsRequest");w(this,"adDisplayContainer");w(this,"adsRenderingSettings");w(this,"vastTracker");w(this,"content");w(this,"eventEmitter");w(this,"cuePoints");w(this,"cueMapPoints");w(this,"started",!1);w(this,"nextAds",[]);w(this,"totalAds",0);w(this,"totalTimeAds",0);w(this,"currentPodIndex",0);w(this,"canBeAdSkippable",!1);w(this,"currentAdBreak");w(this,"currentAdVast");w(this,"currentAd");w(this,"currentCreative");w(this,"queueCreatives",[]);w(this,"processingAdv",!1);w(this,"timerUpdateContentTime");w(this,"adRemainingTime",-1);w(this,"quartilesFired",{start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1});this.adsRequest=t,this.adDisplayContainer=i,this.eventEmitter=new H,this.content=void 0,this.cuePoints=[],this.cueMapPoints={},this.adsRenderingSettings=void 0,this.started=!1,this.processingAdv=!1,this.canBeAdSkippable=!1,this.adRemainingTime=-1,this.fetchVmap=this.fetchVmap.bind(this),this.attachContentMediaEventListeners=this.attachContentMediaEventListeners.bind(this),this.detachContentMediaEventListeners=this.detachContentMediaEventListeners.bind(this),this.handleContentTimeUpdate=this.handleContentTimeUpdate.bind(this),this.adsVideoEventsListener=this.adsVideoEventsListener.bind(this),this.adsVideoErrorListener=this.adsVideoErrorListener.bind(this)}o(e,[{key:"collapse",value:function e(){throw new Error("Method not implemented.")}},{key:"configureAdsManager",value:function e(e,t){this.content=e,this.adsRenderingSettings=t||void 0}},{key:"destroy",value:function e(){this.eventEmitter.clearAllEventListeners(),this.content=void 0,this.adsRenderingSettings=void 0}},{key:"discardAdBreak",value:function e(){}},{key:"expand",value:function e(){}},{key:"focus",value:function e(){}},{key:"getAdSkippableState",value:function e(){return this.canBeAdSkippable}},{key:"getCuePoints",value:function e(){return this.cuePoints}},{key:"getRemainingTime",value:function e(){return this.currentCreative?this.adRemainingTime:-1}},{key:"getVolume",value:function e(){return this.adDisplayContainer.getVideoAdsElement().volume}},{key:"init",value:function e(e,t,i,n){}},{key:"isCustomClickTrackingUsed",value:function e(){throw new Error("Method not implemented.")}},{key:"isCustomPlaybackUsed",value:function e(){throw new Error("Method not implemented.")}},{key:"pause",value:function e(){throw new Error("Method not implemented.")}},{key:"resize",value:function e(e,t,i){throw new Error("Method not implemented.")}},{key:"resume",value:function e(){throw new Error("Method not implemented.")}},{key:"setVolume",value:function e(e){var t=this.adDisplayContainer.getVideoAdsElement();t&&(t.volume=e)}},{key:"skip",value:function e(){var e;var t=this.adDisplayContainer.getVideoAdsElement(),i=((e=this.currentCreative)===null||e===void 0?void 0:e.skipDelay)||0;if(!(!t||i<=0||this.adRemainingTime>i))try{t.pause()}finally{var n;V.debug($,"video user skipped"),(n=this.vastTracker)===null||n===void 0?void 0:n.skip(),this.dispatchAdsEvent(F.Type.SKIPPED),this.playCreativities()}}},{key:"start",value:function e(){this.started||(this.started=!0,this.fetchVastAds(0),this.attachContentMediaEventListeners())}},{key:"stop",value:function e(){this.started=!1}},{key:"updateAdsRenderingSettings",value:function e(e){throw new Error("Method not implemented.")}},{key:"addEventListener",value:function e(e,t,i,n){this.eventEmitter.addEventListener(e,t,i,n)}},{key:"removeEventListener",value:function e(e,t,i,n){this.eventEmitter.removeEventListener(e,t,i)}},{key:"dispatchEvent",value:function e(e){return!0}},{key:"fetchVmap",value:function e(){var e=this;var t=this.adsRequest.adTagUrl;return fetch(t).then(function(e){return e.text()}).then(function(t){var i;var n=(i=new W.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#text"}).parse(t))===null||i===void 0?void 0:i["vmap:VMAP"]["vmap:AdBreak"];if(!n)return e;if(Array.isArray(n))n.forEach(function(t){var i=t["@_timeOffset"];if(i){var n=K(i);if(!isNaN(n)&&e.isValidAdBreak(t)){V.debug($,"vmap adBreak timeOffset [".concat(i,"]:"),n),e.cuePoints.includes(n)||e.cuePoints.push(n);var r=e.cueMapPoints[n]||[];r.push(t),e.cueMapPoints[n]=r}}});else{var r=n["@_timeOffset"];if(r){var a=K(r);!isNaN(a)&&e.isValidAdBreak(n)&&(e.cuePoints.push(a),e.cueMapPoints[a]=[n])}}return e.adDisplayContainer.initialize(),e}).catch(function(e){return Promise.reject(e)})}},{key:"isValidContentObject",value:function e(e){return!!e&&(u(e,HTMLVideoElement)||"currentTime"in e)}},{key:"allAdsCompleted",value:function e(){this.dispatchAdsEvent(F.Type.ALL_ADS_COMPLETED),this.nextAds=[],this.queueCreatives=[],this.vastTracker=void 0,this.currentAdVast=void 0,this.currentAdBreak=void 0,this.currentAd=void 0,this.currentCreative=void 0,this.adRemainingTime=-1,this.canBeAdSkippable=!1,this.detachContentMediaEventListeners(),this.clearVideoAdsContent(),this.adDisplayContainer.hide(),this.processingAdv=!1,this.dispatchAdsEvent(F.Type.CONTENT_RESUME_REQUESTED)}},{key:"playCreativities",value:function e(){this.processingAdv=!0;var e=!!this.currentAd;if(this.currentCreative=void 0,this.currentAdVast&&this.queueCreatives.length>0){var t=this.queueCreatives.shift();if(!t)return this.playCreativities();var i=t.mediaFiles;var n=true,r=false,a=undefined;if(i&&i.length>0)try{for(var s=i[Symbol.iterator](),o;!(n=(o=s.next()).done);n=true){var u=o.value;var l=u.mimeType;if(l&&l.startsWith("video/mp4")&&u.fileURL){this.currentCreative=t,console.log("@@@@@@ CREATIVE"),console.log(this.currentCreative),this.vastTracker=new Q.VASTTracker(null,this.currentAdVast,this.currentCreative);var d=this.totalAds-this.nextAds.length,h=new q(d,!1,this.totalTimeAds,this.currentPodIndex,0,this.totalAds);V.debug($,"current podInfo: [".concat(d,"] [").concat(this.totalTimeAds,"] [").concat(this.totalAds,"]")),this.currentAd=new P(this.currentAdVast,t,u,h),e||this.dispatchAdsEvent(F.Type.CONTENT_PAUSE_REQUESTED),this.playAdsContent(u.fileURL).catch(function(e){});return}}}catch(e){r=true;a=e}finally{try{if(!n&&s.return!=null){s.return()}}finally{if(r){throw a}}}return this.playCreativities()}if(!this.nextAds||this.nextAds.length===0){this.allAdsCompleted();return}var c=this.nextAds.shift();return c?(this.currentAdVast=c,this.queueCreatives=this.getCreativities(c),this.playCreativities()):this.playCreativities()}},{key:"handleContentTimeUpdate",value:function e(){var e=this.content;if(!this.isValidContentObject(e)||this.cuePoints.length===0||this.processingAdv)return;if(this.nextAds&&this.nextAds.length>0){this.processingAdv=!0,this.playCreativities();return}var t=e.currentTime*1e3;V.debug($,"Content current time: [".concat(t,"]"));var i=this.cuePoints.find(function(e){return Math.abs(e-t)<=Y});i&&this.fetchVastAds(i)}},{key:"clearTimerUpdateContentTime",value:function e(){clearTimeout(this.timerUpdateContentTime)}},{key:"startTimerUpdateContentTime",value:function e(){var e=this;this.clearTimerUpdateContentTime(),this.timerUpdateContentTime=setTimeout(function(){e.handleContentTimeUpdate(),e.startTimerUpdateContentTime()},300)}},{key:"attachContentMediaEventListeners",value:function e(){var e=this.content;e&&(u(e,HTMLVideoElement)?e.addEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.startTimerUpdateContentTime())}},{key:"detachContentMediaEventListeners",value:function e(){var e=this.content;if(e)if(u(e,HTMLVideoElement)){var t=e}else"currentTime"in e}},{key:"isValidAdBreak",value:function e(e){var t,i;var n=e["vmap:AdSource"];return!(!n||!((i=n["vmap:AdTagURI"])===null||i===void 0?void 0:(t=i["#text"])===null||t===void 0?void 0:t.trim()))}},{key:"getAdValidCreative",value:function e(e){var t=e.creatives;if(t&&t.length>0){var i=true,n=false,r=undefined;try{for(var a=t[Symbol.iterator](),s;!(i=(s=a.next()).done);i=true){var o=s.value;if(o.type==="linear"){var u=o.mediaFiles;var l=true,d=false,h=undefined;if(u&&u.length>0)try{for(var c=u[Symbol.iterator](),v;!(l=(v=c.next()).done);l=true){var f=v.value;var y=f.mimeType;if(y&&y.startsWith("video/mp4")&&f.fileURL)return o}}catch(e){d=true;h=e}finally{try{if(!l&&c.return!=null){c.return()}}finally{if(d){throw h}}}}}}catch(e){n=true;r=e}finally{try{if(!i&&a.return!=null){a.return()}}finally{if(n){throw r}}}}}},{key:"getCreativities",value:function e(e){var t=[],i=e.creatives;if(i&&i.length>0){var n=true,r=false,a=undefined;try{for(var s=i[Symbol.iterator](),o;!(n=(o=s.next()).done);n=true){var u=o.value;if(u.type==="linear"){var l=u.mediaFiles;var d=true,h=false,c=undefined;if(l&&l.length>0)try{for(var v=l[Symbol.iterator](),f;!(d=(f=v.next()).done);d=true){var y=f.value;var p=y.mimeType;if(p&&p.startsWith("video/mp4")&&y.fileURL){t.push(u);break}}}catch(e){h=true;c=e}finally{try{if(!d&&v.return!=null){v.return()}}finally{if(h){throw c}}}}}}catch(e){r=true;a=e}finally{try{if(!n&&s.return!=null){s.return()}}finally{if(r){throw a}}}}return t}},{key:"trackingEvent",value:function e(e){var t;var i=this.currentCreative;if(!i)return;var n=(t=i.trackingEvents)===null||t===void 0?void 0:t[e];var r=true,a=false,s=undefined;if(n)try{for(var o=n[Symbol.iterator](),u;!(r=(u=o.next()).done);r=true){var l=u.value;this.trackUrl(l)}}catch(e){a=true;s=e}finally{try{if(!r&&o.return!=null){o.return()}}finally{if(a){throw s}}}}},{key:"trackUrl",value:function e(e){try{if(globalThis){var t=new globalThis.Image;t.src=e}}catch(e){}}},{key:"getPromiseVastClient",value:function e(e){return new Q.VASTClient().get(e)}},{key:"fetchVastAds",value:function e(e){return /*#__PURE__*/r(function(){var t,i,n,r,a,s,o,u,l,d,h,c,v,f,y,p,g,A,E,k,C,b,T,S,w,L,_,I,P,D,R,M,U,O,x;return m(this,function(m){switch(m.label){case 0:t=this;if(!this.started)return[3,5];m.label=1;case 1:m.trys.push([1,4,,5]);this.currentPodIndex=e;i=this.cueMapPoints[e];delete this.cueMapPoints[e];n=[],r=0,a=0;if(!i)return[3,3];s=[];o=true,u=false,l=undefined;try{for(d=i[Symbol.iterator]();!(o=(h=d.next()).done);o=true){c=h.value;v=c["vmap:AdSource"];if(v){;p=(y=v["vmap:AdTagURI"])===null||y===void 0?void 0:(f=y["#text"])===null||f===void 0?void 0:f.trim();p&&n.push(this.getPromiseVastClient(p))}}}catch(e){u=true;l=e}finally{try{if(!o&&d.return!=null){d.return()}}finally{if(u){throw l}}}return[4,Promise.allSettled(n)];case 2:g=m.sent();A=true,E=false,k=undefined;try{for(C=g[Symbol.iterator]();!(A=(b=C.next()).done);A=true){T=b.value;if(T.status==="fulfilled"){;;L=T.value,_=(w=L===null||L===void 0?void 0:L.ads)!==null&&w!==void 0?w:void 0;I=true,P=false,D=undefined;if(_&&_.length>0)try{for(R=_[Symbol.iterator]();!(I=(M=R.next()).done);I=true){U=M.value;O=this.getAdValidCreative(U);O&&(s.push(U),r+=O.duration||0,a+=1)}}catch(e){P=true;D=e}finally{try{if(!I&&R.return!=null){R.return()}}finally{if(P){throw D}}}else(S=L.errorURLTemplates)===null||S===void 0?void 0:S.forEach(function(e){t.trackUrl(e)})}}}catch(e){E=true;k=e}finally{try{if(!A&&C.return!=null){C.return()}}finally{if(E){throw k}}}this.nextAds=s,this.totalAds=a,this.totalTimeAds=r;m.label=3;case 3:return[3,5];case 4:x=m.sent();V.error($,"fetchVastAds error:",x);return[3,5];case 5:return[2]}})}).call(this)}},{key:"dispatchAdsEvent",value:function e(e){V.debug($,"dispatchAdsEvent: ",e),this.eventEmitter.emit(e,new F.AdEvent(e,this.currentAd))}},{key:"adsVideoEventsListener",value:function e(e){var t=this.adDisplayContainer.getVideoAdsElement();if(t)switch(e.type){case"canplay":{this.dispatchAdsEvent(F.Type.AD_CAN_PLAY);break}case"metadata":{this.dispatchAdsEvent(F.Type.AD_METADATA);break}case"play":{this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(F.Type.STARTED));break}case"pause":{this.dispatchAdsEvent(F.Type.PAUSED);break}case"timeupdate":{var i=t.duration||-1;if(!isNaN(i)&&i>=0){var n,r;var a=t.currentTime||0,s=a/i,o=i-a,u=((n=this.currentCreative)===null||n===void 0?void 0:n.skipDelay)||0;this.adRemainingTime=o,V.debug($,"video adv currentTime: ".concat(a,", Percentage: ").concat(s,"%, SkipDelay: ").concat(u)),this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(F.Type.STARTED)),!this.quartilesFired.firstQuartile&&s>=.25&&(this.quartilesFired.firstQuartile=!0,this.dispatchAdsEvent(F.Type.FIRST_QUARTILE)),!this.quartilesFired.midpoint&&s>=.5&&(this.quartilesFired.midpoint=!0,this.dispatchAdsEvent(F.Type.MIDPOINT)),!this.quartilesFired.thirdQuartile&&s>=.75&&(this.quartilesFired.thirdQuartile=!0,this.dispatchAdsEvent(F.Type.THIRD_QUARTILE)),(r=this.vastTracker)===null||r===void 0?void 0:r.setProgress(a),!this.canBeAdSkippable&&u>0&&a>=u&&(this.canBeAdSkippable=!0,V.debug($,"video adv can be skippable: [".concat(a,"] [").concat(i,"] [").concat(u,"]")),this.dispatchAdsEvent(F.Type.SKIPPABLE_STATE_CHANGED))}break}case"ended":{var l;this.quartilesFired.complete||(this.quartilesFired.complete=!0,this.dispatchAdsEvent(F.Type.COMPLETE)),(l=this.vastTracker)===null||l===void 0?void 0:l.complete(),this.playCreativities();break}}}},{key:"adsVideoErrorListener",value:function e(e){this.clearVideoAdsContent()}},{key:"clearVideoAdsContent",value:function e(){var e=this.adDisplayContainer.getVideoAdsElement();e&&(e.autoplay=!1,e.pause(),e.src="",e.load())}},{key:"resetQuartilesFired",value:function e(){this.quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1}}},{key:"playAdsContent",value:function e(e){return /*#__PURE__*/r(function(){var t,i;return m(this,function(n){switch(n.label){case 0:t=this.adDisplayContainer.getVideoAdsElement();if(!t)return[2,(V.error($,"playAdsContent no Video Ads Element: "),this.playCreativities())];this.adRemainingTime=-1,this.canBeAdSkippable=!1,this.adDisplayContainer.show(),this.adDisplayContainer.showLoader(),this.removeVideoListeners(),this.resetQuartilesFired(),t.autoplay=!0,t.src=e;n.label=1;case 1:n.trys.push([1,4,5,6]);return[4,G(t)];case 2:n.sent();return[4,t.play()];case 3:n.sent(),this.addVideoListeners(),this.adDisplayContainer.hideLoader(),this.dispatchAdsEvent(F.Type.AD_CAN_PLAY);return[3,6];case 4:i=n.sent();V.error($,"playAdsContent error: ",i),this.dispatchAdsEvent(F.Type.AD_BREAK_FETCH_ERROR),this.playCreativities();return[3,6];case 5:this.adDisplayContainer.hideLoader();return[7];case 6:return[2]}})}).call(this)}},{key:"addVideoListeners",value:function e(){var e=this;var t=this.adDisplayContainer.getVideoAdsElement();t&&(z.forEach(function(i){return t.addEventListener(i,e.adsVideoEventsListener)}),t.addEventListener("error",this.adsVideoErrorListener))}},{key:"removeVideoListeners",value:function e(){var e=this;var t=this.adDisplayContainer.getVideoAdsElement();t&&(z.forEach(function(i){return t.removeEventListener(i,e.adsVideoEventsListener)}),t.removeEventListener("error",this.adsVideoErrorListener))}}]);return e}();var J;(function(e){var t;(function(e){return e.ADS_MANAGER_LOADED="adsManagerLoaded"})(t=e.Type||(e.Type={}));var i=/*#__PURE__*/function(){function e(t){a(this,e);w(this,"currentTarget");w(this,"target");w(this,"type");w(this,"adsManager");this.adsManager=t,this.currentTarget=null,this.target=null,this.type="adsManagerLoaded"}o(e,[{key:"getAdsManager",value:function e(e,t){return this.adsManager.configureAdsManager(e,t),this.adsManager}},{key:"getUserRequestContext",value:function e(){throw new Error("Method not implemented.")}},{key:"preventDefault",value:function e(){throw new Error("Method not implemented.")}},{key:"stopPropagation",value:function e(){throw new Error("Method not implemented.")}}]);return e}();e.AdsManagerLoadedEvent=i})(J||(J={}));var Z=/*#__PURE__*/function(){function e(t){a(this,e);w(this,"adDisplayContainer");w(this,"adsManager");w(this,"eventEmitter");w(this,"userRequestContext");w(this,"imaSdkSettings",new _.ImaSdkSettings);this.adDisplayContainer=t,this.eventEmitter=new H}o(e,[{key:"addEventListener",value:function e(e,t,i,n){this.eventEmitter.addEventListener(e,t,i,n)}},{key:"contentComplete",value:function e(){}},{key:"dispatchEvent",value:function e(e){return!0}},{key:"getSettings",value:function e(){return this.imaSdkSettings}},{key:"getVersion",value:function e(){return"custom"}},{key:"removeEventListener",value:function e(e,t,i,n){this.eventEmitter.removeEventListener(e,t,i)}},{key:"requestAds",value:function e(e,t){var i=this;if(this.userRequestContext=t||void 0,!e.adTagUrl){var n=new N(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,"Admanegger is already defined or adTagUrl is not defined");this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,n);return}this.adsManager=new X(e,this.adDisplayContainer),this.adsManager.fetchVmap().then(function(e){return i.adsManager=e,i.eventEmitter.emit(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,new J.AdsManagerLoadedEvent(e))}).catch(function(e){var t=new N(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,e.message)})}},{key:"destroy",value:function e(){var e;(e=this.adsManager)===null||e===void 0?void 0:e.destroy(),this.adDisplayContainer.destroy(),this.eventEmitter.clearAllEventListeners()}}]);return e}();var ee=function e(){a(this,e);w(this,"autoAlign",!1);w(this,"bitrate",-1);w(this,"enablePreloading",!1);w(this,"loadVideoTimeout",-1);w(this,"mimeTypes",null);w(this,"playAdsAfterTime",0);w(this,"restoreCustomPlaybackStateOnAdBreakComplete",!1);w(this,"uiElements",null);w(this,"useStyledLinearAds",!0);w(this,"useStyledNonLinearAds",!1)};var et=/*#__PURE__*/function(){function e(){a(this,e);w(this,"adTagUrl");w(this,"adsResponse");w(this,"contentDuration");w(this,"contentKeywords");w(this,"contentTitle");w(this,"forceNonLinearFullSlot");w(this,"linearAdSlotHeight");w(this,"linearAdSlotWidth");w(this,"liveStreamPrefetchSeconds");w(this,"nonLinearAdSlotHeight");w(this,"nonLinearAdSlotWidth");w(this,"omidAccessModeRules");w(this,"pageUrl");w(this,"vastLoadTimeout");this.adTagUrl="",this.adsResponse=null,this.contentDuration=null,this.contentKeywords=null,this.contentTitle=null,this.forceNonLinearFullSlot=!1,this.linearAdSlotHeight=0,this.linearAdSlotWidth=0,this.liveStreamPrefetchSeconds=0,this.nonLinearAdSlotHeight=0,this.nonLinearAdSlotWidth=0,this.omidAccessModeRules={},this.pageUrl=null,this.vastLoadTimeout=0}o(e,[{key:"setAdWillAutoPlay",value:function e(e){}},{key:"setAdWillPlayMuted",value:function e(e){}},{key:"setContinuousPlayback",value:function e(e){}}]);return e}();function ei(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"debug";V.setEnable(e),V.setLogLevel(t)}var en=function(e){return e.FULLSCREEN="fullscreen",e.NORMAL="normal",e}(en||{});String.prototype.trimStart||(String.prototype.trimStart=String.prototype.trimLeft);typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1});0&&(module.exports={Ad:Ad,AdDisplayContainer:AdDisplayContainer,AdError:AdError,AdErrorEvent:AdErrorEvent,AdEvent:AdEvent,AdPodInfo:AdPodInfo,AdsLoader:AdsLoader,AdsManager:AdsManager,AdsManagerLoadedEvent:AdsManagerLoadedEvent,AdsRenderingSettings:AdsRenderingSettings,AdsRequest:AdsRequest,ImaSdkSettings:ImaSdkSettings,ViewMode:ViewMode,activateDebug:activateDebug,settings:settings});