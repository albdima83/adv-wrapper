/* ESM | Version: 0.0.4 | Commit: cb8e275 */
var H="0.0.4";var k=(n=>(n[n.DEPRECATED_ERROR_CODE=-1]="DEPRECATED_ERROR_CODE",n[n.VAST_MALFORMED_RESPONSE=-1]="VAST_MALFORMED_RESPONSE",n[n.VAST_SCHEMA_VALIDATION_ERROR=101]="VAST_SCHEMA_VALIDATION_ERROR",n[n.VAST_UNSUPPORTED_VERSION=102]="VAST_UNSUPPORTED_VERSION",n[n.VAST_TRAFFICKING_ERROR=200]="VAST_TRAFFICKING_ERROR",n[n.VAST_UNEXPECTED_LINEARITY=201]="VAST_UNEXPECTED_LINEARITY",n[n.VAST_UNEXPECTED_DURATION_ERROR=202]="VAST_UNEXPECTED_DURATION_ERROR",n[n.VAST_WRAPPER_ERROR=300]="VAST_WRAPPER_ERROR",n[n.VAST_LOAD_TIMEOUT=301]="VAST_LOAD_TIMEOUT",n[n.VAST_TOO_MANY_REDIRECTS=302]="VAST_TOO_MANY_REDIRECTS",n[n.VAST_NO_ADS_AFTER_WRAPPER=303]="VAST_NO_ADS_AFTER_WRAPPER",n[n.VIDEO_PLAY_ERROR=400]="VIDEO_PLAY_ERROR",n[n.VAST_MEDIA_LOAD_TIMEOUT=402]="VAST_MEDIA_LOAD_TIMEOUT",n[n.VAST_LINEAR_ASSET_MISMATCH=403]="VAST_LINEAR_ASSET_MISMATCH",n[n.VAST_PROBLEM_DISPLAYING_MEDIA_FILE=405]="VAST_PROBLEM_DISPLAYING_MEDIA_FILE",n[n.OVERLAY_AD_PLAYING_FAILED=500]="OVERLAY_AD_PLAYING_FAILED",n[n.NONLINEAR_DIMENSIONS_ERROR=501]="NONLINEAR_DIMENSIONS_ERROR",n[n.OVERLAY_AD_LOADING_FAILED=-1]="OVERLAY_AD_LOADING_FAILED",n[n.VAST_NONLINEAR_ASSET_MISMATCH=503]="VAST_NONLINEAR_ASSET_MISMATCH",n[n.COMPANION_REQUIRED_ERROR=602]="COMPANION_REQUIRED_ERROR",n[n.COMPANION_AD_LOADING_FAILED=-1]="COMPANION_AD_LOADING_FAILED",n[n.UNKNOWN_ERROR=900]="UNKNOWN_ERROR",n[n.VPAID_ERROR=901]="VPAID_ERROR",n[n.FAILED_TO_REQUEST_ADS=1005]="FAILED_TO_REQUEST_ADS",n[n.VAST_ASSET_NOT_FOUND=1007]="VAST_ASSET_NOT_FOUND",n[n.VAST_EMPTY_RESPONSE=1009]="VAST_EMPTY_RESPONSE",n[n.UNKNOWN_AD_RESPONSE=1010]="UNKNOWN_AD_RESPONSE",n[n.UNSUPPORTED_LOCALE=1011]="UNSUPPORTED_LOCALE",n[n.ADS_REQUEST_NETWORK_ERROR=1012]="ADS_REQUEST_NETWORK_ERROR",n[n.INVALID_AD_TAG=1013]="INVALID_AD_TAG",n[n.PROTECTED_AUDIENCE_API_ERROR=1014]="PROTECTED_AUDIENCE_API_ERROR",n[n.STREAM_INITIALIZATION_FAILED=1020]="STREAM_INITIALIZATION_FAILED",n[n.ASSET_FALLBACK_FAILED=1021]="ASSET_FALLBACK_FAILED",n[n.UNSUPPORTED_URL=1022]="UNSUPPORTED_URL",n[n.INVALID_ARGUMENTS=1101]="INVALID_ARGUMENTS",n[n.NATIVE_MESSAGE_ERROR=1204]="NATIVE_MESSAGE_ERROR",n[n.AUTOPLAY_DISALLOWED=1205]="AUTOPLAY_DISALLOWED",n[n.CONSENT_MANAGEMENT_PROVIDER_NOT_READY=1300]="CONSENT_MANAGEMENT_PROVIDER_NOT_READY",n[n.Cj=2002]="Cj",n[n.VIDEO_ELEMENT_USED=-1]="VIDEO_ELEMENT_USED",n[n.VIDEO_ELEMENT_REQUIRED=-1]="VIDEO_ELEMENT_REQUIRED",n[n.VAST_MEDIA_ERROR=-1]="VAST_MEDIA_ERROR",n[n.ADSLOT_NOT_VISIBLE=-1]="ADSLOT_NOT_VISIBLE",n))(k||{});var C=(t=>(t.AD_LOAD="adLoadError",t.AD_PLAY="adPlayError",t))(C||{});var M=(e=>(e.AD_ERROR="adError",e))(M||{});var P=(r=>(r.AD_CAN_PLAY="adCanPlay",r.wi="adStarted",r.CONTENT_PAUSE_REQUESTED="contentPauseRequested",r.CONTENT_RESUME_REQUESTED="contentResumeRequested",r.CLICK="click",r.VIDEO_CLICKED="videoClicked",r.VIDEO_ICON_CLICKED="videoIconClicked",r.Ne="engagedView",r.EXPANDED_CHANGED="expandedChanged",r.STARTED="start",r.AD_PROGRESS="adProgress",r.AD_BUFFERING="adBuffering",r.IMPRESSION="impression",r.Ue="measurable_impression",r.VIEWABLE_IMPRESSION="viewable_impression",r.Oe="fully_viewable_audible_half_duration_impression",r.mg="overlay_resize",r.ng="overlay_unmeasurable_impression",r.og="overlay_unviewable_impression",r.qg="overlay_viewable_immediate_impression",r.pg="overlay_viewable_end_of_session_impression",r.Oi="externalActivityEvent",r.PAUSED="pause",r.RESUMED="resume",r.FIRST_QUARTILE="firstQuartile",r.MIDPOINT="midpoint",r.THIRD_QUARTILE="thirdQuartile",r.COMPLETE="complete",r.DURATION_CHANGE="durationChange",r.USER_CLOSE="userClose",r.Ij="userRecall",r.vj="prefetched",r.LOADED="loaded",r.ALL_ADS_COMPLETED="allAdsCompleted",r.SKIPPED="skip",r.ug="skipShown",r.LINEAR_CHANGED="linearChanged",r.SKIPPABLE_STATE_CHANGED="skippableStateChanged",r.AD_METADATA="adMetadata",r.AD_BREAK_FETCH_ERROR="adBreakFetchError",r.AD_BREAK_READY="adBreakReady",r.LOG="log",r.VOLUME_CHANGED="volumeChange",r.VOLUME_MUTED="mute",r.INTERACTION="interaction",r.Bi="companionBackfill",r.Gj="trackingUrlPinged",r.Jj="video_card_endcap_collapse",r.Kj="video_card_endcap_dismiss",r.Lj="video_card_endcap_impression",r.Ei="companionInitialized",r.Di="companionImpression",r.Ci="companionClick",r.pj="mediaUrlPinged",r.LOAD_START="loadStart",r.rj="navigationRequested",r))(P||{});var V=(e=>(e.ADS_MANAGER_LOADED="adsManagerLoaded",e))(V||{});var x=(t=>(t.ALWAYS="always",t.ON_MASTER_AD="on_master_ad",t))(x||{});var O=(i=>(i[i.DISABLED=0]="DISABLED",i[i.ENABLED=1]="ENABLED",i[i.INSECURE=2]="INSECURE",i))(O||{});var N=(t=>(t.NORMAL="normal",t.FULLSCREEN="fullscreen",t))(N||{});var X=x,J=O,A=class{static CompanionBackfillMode=X;static VpaidMode=J;autoPlayAdBreaks=!0;cookiesEnabled=!0;companionBackfill=google.ima.ImaSdkSettings.CompanionBackfillMode.ALWAYS;featureFlags={};locale="en";vpaidMode=google.ima.ImaSdkSettings.VpaidMode.ENABLED;numRedirects=-1;disableCustomPlaybackForIOS10Plus=!1;playerType="";playerVersion="";ppid="";sessionId="";allowVpaid=!0;getCompanionBackfill(){return google.ima.ImaSdkSettings.CompanionBackfillMode.ALWAYS}getDisableCustomPlaybackForIOS10Plus(){return!0}getFeatureFlags(){return this.featureFlags}getLocale(){return this.locale}getNumRedirects(){return this.numRedirects}getPlayerType(){return this.playerType}getPlayerVersion(){return this.playerVersion}getPpid(){return this.ppid}isCookiesEnabled(){return this.cookiesEnabled}setAutoPlayAdBreaks(e){this.autoPlayAdBreaks=e}setCompanionBackfill(){this.companionBackfill=google.ima.ImaSdkSettings.CompanionBackfillMode.ALWAYS}setCookiesEnabled(e){this.cookiesEnabled=e}setDisableCustomPlaybackForIOS10Plus(e){this.disableCustomPlaybackForIOS10Plus=e}setFeatureFlags(e){this.featureFlags=e}setLocale(e){this.locale=e}setNumRedirects(e){this.numRedirects=e}setPlayerType(e){this.playerType=e}setPlayerVersion(e){this.playerVersion=e}setPpid(e){this.ppid=e}setSessionId(e){this.sessionId=e}setVpaidAllowed(e){this.allowVpaid=e}setVpaidMode(e){this.vpaidMode=e}};var Z=new A;var j=["debug","info","warn","error","fatal","trace"],_={debug:console.debug||console.log,info:console.info||console.log,warn:console.warn||console.log,error:console.error||console.log,fatal:console.error||console.log,trace:console.trace||console.log},U=class{enable;level;constructor(e){this.enable=e.enable||!1,this.level=e.level||"info"}debug(e,t,...i){this.log("debug",e,t,...i)}info(e,t,...i){this.log("info",e,t,...i)}warn(e,t,...i){this.log("warn",e,t,...i)}error(e,t,...i){this.log("error",e,t,...i)}setLogLevel(e){this.level=e}setEnable(e){this.enable=e}log(e,t,i,...s){if(this.enable&&j.indexOf(e)>=j.indexOf(this.level)){let d=new Date().toISOString();(_[e]??console.log)(`[${d}]  [${t}] [${e}]`,i,...s)}}},ee=new U({enable:!1,level:"error"}),a=ee;var te="ima:Ad",y=class{adId;adPodInfo;adSystem;advertiserName;apiFramework;companionAds;creativeAdId;creativeId;dealId;description;duration;height;mediaUrl;minSuggestedDuration;skipTimeOffset;surveyUrl;title;traffickingParameters;traffickingParametersString;uiElements;universalAdIdRegistry;universalAdIdValue;universalAdIds;vastMediaBitrate;vastMediaHeight;vastMediaWidth;width;wrapperAdIds;wrapperAdSystems;wrapperCreativeIds;linear;constructor(e,t,i,s){this.adId=e.id||"undefined",this.adPodInfo=s,this.adSystem=e.adSystem||"",this.advertiserName=e.advertiser||"",this.apiFramework=t.apiFramework||"",this.companionAds=[],this.creativeAdId=t.adId||"",this.creativeId=t.id||"",this.dealId="",this.description=e.description||"",this.duration=t.duration||0,this.height=0,this.mediaUrl=null,this.minSuggestedDuration=0,this.skipTimeOffset=t.skipDelay||-1,this.surveyUrl=null,this.title=e.adTitle||"",this.traffickingParameters={},this.traffickingParametersString="",this.uiElements=[],this.universalAdIdRegistry="",this.universalAdIdValue="",this.universalAdIds=[],this.vastMediaBitrate=0,this.vastMediaHeight=0,this.vastMediaWidth=0,this.width=0,this.wrapperAdIds=[],this.wrapperAdSystems=[],this.wrapperCreativeIds=[],this.linear=t.type==="linear"}getAdId(){return this.adId}getAdPodInfo(){return this.adPodInfo}getAdSystem(){return this.adSystem}getAdvertiserName(){return this.advertiserName}getApiFramework(){return this.apiFramework}getCompanionAds(e,t,i){return a.debug(te,`Ad adSlotWidth:[${e}] adSlotHeight[${t}] settings:`,i),this.companionAds}getCreativeAdId(){return this.creativeAdId}getCreativeId(){return this.creativeId}getDealId(){return this.dealId}getDescription(){return this.description}getDuration(){return this.duration}getHeight(){return this.height}getMediaUrl(){return this.mediaUrl}getMinSuggestedDuration(){return this.minSuggestedDuration}getSkipTimeOffset(){return this.skipTimeOffset}getSurveyUrl(){return this.surveyUrl}getTitle(){return this.title}getTraffickingParameters(){return this.traffickingParameters}getTraffickingParametersString(){return this.traffickingParametersString}getUiElements(){return this.uiElements}getUniversalAdIdRegistry(){throw new Error("Method not implemented.")}getUniversalAdIdValue(){return this.universalAdIdValue}getUniversalAdIds(){return this.universalAdIds}getVastMediaBitrate(){return this.vastMediaBitrate}getVastMediaHeight(){return this.vastMediaHeight}getVastMediaWidth(){return this.vastMediaWidth}getWidth(){return this.width}getWrapperAdIds(){return this.wrapperAdIds}getWrapperAdSystems(){return this.wrapperAdSystems}getWrapperCreativeIds(){return this.wrapperCreativeIds}isLinear(){return this.linear}};var E="ima:AdDisplayContainer",q=class{adContainer;videoElement;contentElement;adsContainerElement;adsSpinnerElement;videoAdsElement;constructor(e,t,i){this.adContainer=e,this.videoElement=t,this.contentElement=i}initialize(){a.debug(E,"initialize"),this.adsContainerElement||(this.adsContainerElement=this.createAdsContainer()),this.videoAdsElement||(this.videoAdsElement=this.createAdsVideoElement()),this.adsSpinnerElement||(this.adsSpinnerElement=this.createAdsSpinner())}destroy(){a.debug(E,"destroy"),this.videoAdsElement?.remove(),this.adsSpinnerElement?.remove(),this.adsContainerElement?.remove(),this.videoAdsElement=void 0}addEventListener(e,t,i){a.debug(E,`addEventListener [${e}] listener [${t}] useCapture [${i}]`)}removeEventListener(e,t,i){a.debug(E,`removeEventListener [${e}] listener [${t}] useCapture [${i}]`)}dispatchEvent(e){return a.debug(E,`dispatchEvent [${e}`),!0}getVideoAdsElement(){return this.videoAdsElement||this.videoElement}show(){let e=this.adsContainerElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}hide(){let e=this.adsContainerElement;e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0")}showLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="block")}hideLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="none")}hideAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.visibility="hidden",e.style.opacity="0")}showAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}clearAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="none",e.autoplay=!1,e.pause(),e.src="",e.load())}createAdsContainer(){let e=this.adContainer;if(!e)return;let t=document.getElementById("adm-adv-container")||document.createElement("div");return t.id="adm-adv-container",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.background="rgb(0,0,0)",t.style.display="none",e.appendChild(t),t}createAdsSpinner(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-adv-spinner")||document.createElement("div");t.id="adm-adv-spinner",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="40px",t.style.height="40px",t.style.border="5px solid #ccc",t.style.borderTop="5px solid #333",t.style.borderRadius="50%",t.style.zIndex="10",t.style.animation="adm-spinner-animation 1s linear infinite",t.style.display="none";let i=document.createElement("style");return i.textContent=`
      @keyframes adm-spinner-animation {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
    `,globalThis&&globalThis.document&&document.head.appendChild(i),e.appendChild(t),t}createAdsVideoElement(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-video-ads")||document.createElement("video");return t.id="adm-video-ads",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100%",t.style.height="100%",t.style.objectFit="cover",t.style.background="black",t.controls=!1,t.playsInline=!1,t.setAttribute("disablePictureInPicture",""),t.setAttribute("disableRemotePlayback",""),t.setAttribute("playsinline","false"),t.setAttribute("webkit-playsinline","false"),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("object","fit"),t.removeAttribute("controls"),e.appendChild(t),t}};var ie=k,ne=C,T=class{static ErrorCode=ie;static Type=ne;name;code;message;stack;cause;constructor(e,t){this.name="AdError",this.message=t,this.code=e}getErrorCode(){return this.code}getInnerError(){return new Error(this.message)}getMessage(){return this.message}getType(){return""}getVastErrorCode(){return this.code}};var se=M,g=class u{static Type=se;target;currentTarget;type=u.Type.AD_ERROR;adError;userRequestContext;constructor(e,t){this.adError=e,this.userRequestContext=t}getError(){return this.adError||null}getUserRequestContext(){return this.userRequestContext||null}preventDefault(){}stopPropagation(){}};var re=P,L=class u{static Type=re;currentTarget;target;type=u.Type.LOADED;ad=void 0;adData=null;constructor(e,t){this.type=e,this.ad=t}getAd(){return this.ad||null}getAdData(){return this.adData}preventDefault(){}stopPropagation(){}};var R=class{adPosition;isBumper;maxDuration;podIndex;timeOffset;totalAds;constructor(e,t,i,s,d,p){this.adPosition=e,this.isBumper=t,this.maxDuration=i,this.podIndex=s,this.timeOffset=d,this.totalAds=p}getAdPosition(){return this.adPosition}getIsBumper(){return this.isBumper}getMaxDuration(){return this.maxDuration}getPodIndex(){return this.podIndex}getTimeOffset(){return this.timeOffset}getTotalAds(){return this.totalAds}};var b=class{listeners={};addEventListener(e,t,i=!1,s=null){if(t===null)throw new Error("Handler cannot be null");this.listeners[e]||(this.listeners[e]=[]);let d=typeof t=="function"?t:t.handleEvent;if(typeof d!="function")throw new Error("Handler must be a function or have a handleEvent method");this.listeners[e].push({handler:d,scope:s,capture:i})}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>{i.handler.apply(i.scope,t)})}removeEventListener(e,t,i=!1){if(!this.listeners[e]||t===null)return;let s=typeof t=="function"?t:t.handleEvent;this.listeners[e]=this.listeners[e].filter(d=>d.handler!==s||d.capture!==i)}clearEventListeners(e){delete this.listeners[e]}clearAllEventListeners(){this.listeners={}}};import{VASTClient as de,VASTTracker as le}from"@dailymotion/vast-client";import{XMLParser as oe}from"fast-xml-parser";var ae=/^\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?$/;function w(u){if(u=="start"||u=="end")return 0;if(ae.test(u)){let[e="00",t="00",i="00"]=u.split(":"),s="00",d="000";return i.includes(".")?[s,d]=i.split("."):s=i,(parseInt(e,10)*3600+parseInt(t,10)*60+parseInt(s,10))*1e3+parseInt(d,10)}return parseFloat(u)}function $(u){return new Promise((e,t)=>{u.preload="auto",u.load();let i=()=>{u.removeEventListener("canplay",i),e()},s=()=>{u.removeEventListener("error",s),t(new Error("Video failed to load"))};u.addEventListener("canplaythrough",i),u.addEventListener("error",s)})}var W=["play","pause","ended","waiting","stalled","canplay","playing","seeking","seeked","timeupdate","durationchange","loadedmetadata","suspend","abort"],ue=500,h="ima:AdsManager",D=class{adsRequest;adDisplayContainer;adsRenderingSettings=void 0;vastTracker;content=void 0;eventEmitter;cuePoints;cueMapPoints;started=!1;nextAds=[];totalAds=0;totalTimeAds=0;currentPodIndex=0;canBeAdSkippable=!1;currentAdBreak=void 0;currentAdVast=void 0;currentAd=void 0;currentCreative=void 0;queueCreatives=[];processingAdv=!1;timerUpdateContentTime=void 0;adRemainingTime=-1;adDuration=-1;quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1};constructor(e,t){this.adsRequest=e,this.adDisplayContainer=t,this.eventEmitter=new b,this.content=void 0,this.cuePoints=[],this.cueMapPoints={},this.adsRenderingSettings=void 0,this.started=!1,this.processingAdv=!1,this.canBeAdSkippable=!1,this.adRemainingTime=-1,this.adDuration=-1,this.fetchVmap=this.fetchVmap.bind(this),this.attachContentMediaEventListeners=this.attachContentMediaEventListeners.bind(this),this.detachContentMediaEventListeners=this.detachContentMediaEventListeners.bind(this),this.handleContentTimeUpdate=this.handleContentTimeUpdate.bind(this),this.adsVideoEventsListener=this.adsVideoEventsListener.bind(this),this.adsVideoErrorListener=this.adsVideoErrorListener.bind(this)}collapse(){throw new Error("Method not implemented.")}configureAdsManager(e,t){this.content=e,this.adsRenderingSettings=t||void 0}destroy(){this.detachContentMediaEventListeners(),this.eventEmitter.clearAllEventListeners(),this.content=void 0,this.adsRenderingSettings=void 0}discardAdBreak(){}expand(){}focus(){}getAdSkippableState(){return this.canBeAdSkippable}getCuePoints(){return this.cuePoints}getRemainingTime(){return this.currentCreative?this.adRemainingTime:-1}getVolume(){return this.adDisplayContainer.getVideoAdsElement().volume}init(e,t,i,s){a.debug(h,`init width[${e}] height[${t}] viewMode[${i}] videoElement[${s}]`)}isCustomClickTrackingUsed(){return a.debug(h,"isCustomClickTrackingUsed"),!1}isCustomPlaybackUsed(){return a.debug(h,"isCustomPlaybackUsed"),!0}pause(){a.debug(h,"pause")}resize(e,t,i){a.debug(h,`resize width[${e}] height[${t}] viewMode[${i}]`)}resume(){a.debug(h,"resume")}setVolume(e){let t=this.adDisplayContainer.getVideoAdsElement();t&&(t.volume=e)}skip(){let e=this.adDisplayContainer.getVideoAdsElement(),t=this.currentCreative?.skipDelay||0;if(!(!e||t<=0||this.adRemainingTime>t&&this.adRemainingTime<this.adDuration))try{e.pause()}finally{a.debug(h,"video user skipped"),this.vastTracker?.skip(),this.dispatchAdsEvent(google.ima.AdEvent.Type.SKIPPED),this.playCreativities()}}start(){this.started||(this.started=!0,this.fetchVastAds(0),this.attachContentMediaEventListeners())}stop(){this.started=!1}updateAdsRenderingSettings(e){a.debug(h,`updateAdsRenderingSettings [${e}]`)}addEventListener(e,t,i,s){this.eventEmitter.addEventListener(e,t,i,s)}removeEventListener(e,t,i,s){this.eventEmitter.removeEventListener(e,t,i)}dispatchEvent(e){return a.debug(h,`dispatchEvent: [${e}]`),!0}fetchVmap(){let e=this.adsRequest.adTagUrl;return fetch(e).then(t=>t.text()).then(t=>{let d=new oe({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#text"}).parse(t)?.["vmap:VMAP"]["vmap:AdBreak"];if(!d)return this;if(Array.isArray(d))d.forEach(p=>{let c=p["@_timeOffset"];if(c){let m=w(c);if(!isNaN(m)&&this.isValidAdBreak(p)){a.debug(h,`vmap adBreak timeOffset [${c}]:`,m),this.cuePoints.includes(m)||this.cuePoints.push(m);let v=this.cueMapPoints[m]||[];v.push(p),this.cueMapPoints[m]=v}}});else{let p=d["@_timeOffset"];if(p){let c=w(p);!isNaN(c)&&this.isValidAdBreak(d)&&(this.cuePoints.push(c),this.cueMapPoints[c]=[d])}}return this.adDisplayContainer.initialize(),this}).catch(t=>Promise.reject(t))}isValidContentObject(e){return!!e&&(e instanceof HTMLVideoElement||"currentTime"in e)}allAdsCompleted(){this.removeVideoListeners(),this.dispatchAdsEvent(google.ima.AdEvent.Type.ALL_ADS_COMPLETED),this.nextAds=[],this.queueCreatives=[],this.vastTracker=void 0,this.currentAdVast=void 0,this.currentAdBreak=void 0,this.currentAd=void 0,this.currentCreative=void 0,this.adRemainingTime=-1,this.canBeAdSkippable=!1,this.adDisplayContainer?.hideAdVideoElement(),this.adDisplayContainer?.clearAdVideoElement(),this.adDisplayContainer?.hide(),this.processingAdv=!1,this.dispatchAdsEvent(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED)}playCreativities(){this.processingAdv=!0;let e=!!this.currentAd;if(this.currentCreative=void 0,this.currentAdVast&&this.queueCreatives.length>0){let i=this.queueCreatives.shift();if(!i)return this.playCreativities();let s=i.mediaFiles;if(s&&s.length>0)for(let d of s){let p=d.mimeType;if(p&&p.startsWith("video/mp4")&&d.fileURL){this.currentCreative=i,this.vastTracker=new le(null,this.currentAdVast,this.currentCreative);let c=this.totalAds-this.nextAds.length,m=new R(c,!1,this.totalTimeAds,this.currentPodIndex,0,this.totalAds);a.debug(h,`current podInfo: [${c}] [${this.totalTimeAds}] [${this.totalAds}]`),this.currentAd=new y(this.currentAdVast,i,d,m),e||this.dispatchAdsEvent(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED),this.playAdsContent(d.fileURL).catch(v=>{a.error(h,"playAdsContent error: ",v)});return}}return this.playCreativities()}if(!this.nextAds||this.nextAds.length===0){this.allAdsCompleted();return}let t=this.nextAds.shift();return t?(this.currentAdVast=t,this.queueCreatives=this.getCreativities(t),this.playCreativities()):this.playCreativities()}handleContentTimeUpdate(){let e=this.content;if(!this.isValidContentObject(e)||this.cuePoints.length===0||this.processingAdv)return;if(this.nextAds&&this.nextAds.length>0){this.processingAdv=!0,this.playCreativities();return}let t=e.currentTime*1e3;a.debug(h,`Content current time: [${t}]`);let i=this.cuePoints.find(s=>Math.abs(s-t)<=ue);i&&this.fetchVastAds(i)}clearTimerUpdateContentTime(){clearTimeout(this.timerUpdateContentTime)}startTimerUpdateContentTime(){this.clearTimerUpdateContentTime(),this.timerUpdateContentTime=setTimeout(()=>{this.handleContentTimeUpdate(),this.startTimerUpdateContentTime()},300)}attachContentMediaEventListeners(){let e=this.content;e&&(e instanceof HTMLVideoElement?e.addEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.startTimerUpdateContentTime())}detachContentMediaEventListeners(){let e=this.content;e&&(e instanceof HTMLVideoElement?e.removeEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.clearTimerUpdateContentTime())}isValidAdBreak(e){let t=e["vmap:AdSource"];return!(!t||!t["vmap:AdTagURI"]?.["#text"]?.trim())}getAdValidCreative(e){let t=e.creatives;if(t&&t.length>0){for(let i of t)if(i.type==="linear"){let p=i.mediaFiles;if(p&&p.length>0)for(let c of p){let m=c.mimeType;if(m&&m.startsWith("video/mp4")&&c.fileURL)return i}}}}getCreativities(e){let t=[],i=e.creatives;if(i&&i.length>0){for(let s of i)if(s.type==="linear"){let c=s.mediaFiles;if(c&&c.length>0)for(let m of c){let v=m.mimeType;if(v&&v.startsWith("video/mp4")&&m.fileURL){t.push(s);break}}}}return t}trackingEvent(e){let t=this.currentCreative;if(!t)return;let s=t.trackingEvents?.[e];if(s)for(let d of s)this.trackUrl(d)}trackUrl(e){try{if(globalThis){let t=new globalThis.Image;t.src=e}}catch(t){a.error(h,`trackUrl [${e}] error: `,t)}}getPromiseVastClient(e){return new de().get(e)}async fetchVastAds(e){if(this.started)try{this.currentPodIndex=e;let t=this.cueMapPoints[e];delete this.cueMapPoints[e];let i=[],s=0,d=0;if(t){let p=[];for(let m of t){let v=m["vmap:AdSource"];if(v){let f=v["vmap:AdTagURI"]?.["#text"]?.trim();f&&i.push(this.getPromiseVastClient(f))}}let c=await Promise.allSettled(i);for(let m of c)if(m.status==="fulfilled"){let v=m.value,f=v?.ads??void 0;if(f&&f.length>0)for(let S of f){let B=this.getAdValidCreative(S);B&&(p.push(S),s+=B.duration||0,d+=1)}else v.errorURLTemplates?.forEach(S=>{this.trackUrl(S)})}this.nextAds=p,this.totalAds=d,this.totalTimeAds=s,this.nextAds.length===0?this.allAdsCompleted():this.playCreativities()}}catch(t){a.error(h,"fetchVastAds error:",t)}}dispatchAdsEvent(e){a.debug(h,"dispatchAdsEvent: ",e),this.eventEmitter.emit(e,new L(e,this.currentAd))}adsVideoEventsListener(e){let t=this.adDisplayContainer.getVideoAdsElement();if(t)switch(e.type){case"canplay":{this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_CAN_PLAY);break}case"metadata":{this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_METADATA);break}case"play":{this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.STARTED));break}case"pause":{this.dispatchAdsEvent(google.ima.AdEvent.Type.PAUSED);break}case"timeupdate":{let i=t.duration||-1;if(!isNaN(i)&&i>=0){let s=t.currentTime||0,d=s/i,p=i-s,c=this.currentCreative?.skipDelay||0;this.adRemainingTime=p,this.adDuration=i,a.debug(h,`video adv currentTime: ${s}, Percentage: ${d}%, SkipDelay: ${c}`),this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.STARTED)),!this.quartilesFired.firstQuartile&&d>=.25&&(this.quartilesFired.firstQuartile=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.FIRST_QUARTILE)),!this.quartilesFired.midpoint&&d>=.5&&(this.quartilesFired.midpoint=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.MIDPOINT)),!this.quartilesFired.thirdQuartile&&d>=.75&&(this.quartilesFired.thirdQuartile=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.THIRD_QUARTILE)),this.vastTracker?.setProgress(s),!this.canBeAdSkippable&&c>0&&s>=c&&(this.canBeAdSkippable=!0,a.debug(h,`video adv can be skippable: [${s}] [${i}] [${c}]`),this.dispatchAdsEvent(google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED))}break}case"ended":{this.adRemainingTime=-1,this.adDuration=-1,this.quartilesFired.complete||(this.quartilesFired.complete=!0,this.dispatchAdsEvent(google.ima.AdEvent.Type.COMPLETE)),this.vastTracker?.complete(),this.playCreativities();break}}}adsVideoErrorListener(e){a.error(h,"adsVideoErrorListener: ",e),this.adDisplayContainer?.hideAdVideoElement(),this.adDisplayContainer?.clearAdVideoElement(),this.playCreativities()}resetQuartilesFired(){this.quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1}}async playAdsContent(e){let t=this.adDisplayContainer.getVideoAdsElement();if(!t)return a.error(h,"playAdsContent no Video Ads Element: "),this.playCreativities();this.adRemainingTime=-1,this.adDuration=-1,this.canBeAdSkippable=!1,this.resetQuartilesFired(),this.removeVideoListeners(),this.adDisplayContainer?.show(),this.adDisplayContainer?.showLoader(),this.adDisplayContainer?.hideAdVideoElement(),t.src=e,t.autoplay=!0;try{await $(t),await t.play(),this.addVideoListeners(),this.adDisplayContainer?.showAdVideoElement(),this.adDisplayContainer?.hideLoader(),this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_CAN_PLAY)}catch(i){a.error(h,"playAdsContent error: ",i),this.dispatchAdsEvent(google.ima.AdEvent.Type.AD_BREAK_FETCH_ERROR),this.adDisplayContainer?.hideAdVideoElement(),this.playCreativities()}finally{this.adDisplayContainer.hideLoader()}}addVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(W.forEach(t=>e.addEventListener(t,this.adsVideoEventsListener)),e.addEventListener("error",this.adsVideoErrorListener))}removeVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(W.forEach(t=>e.removeEventListener(t,this.adsVideoEventsListener)),e.removeEventListener("error",this.adsVideoErrorListener))}};var pe=V,I=class{static Type=pe;currentTarget;target;type;adsManager;constructor(e){this.adsManager=e,this.currentTarget=null,this.target=null,this.type="adsManagerLoaded"}getAdsManager(e,t){return this.adsManager.configureAdsManager(e,t),this.adsManager}getUserRequestContext(){throw new Error("Method not implemented.")}preventDefault(){throw new Error("Method not implemented.")}stopPropagation(){throw new Error("Method not implemented.")}};var G="ima:AdsLoader",Q=class{adDisplayContainer;adsManager=void 0;eventEmitter;userRequestContext=void 0;imaSdkSettings=new A;constructor(e){this.adDisplayContainer=e,this.eventEmitter=new b}addEventListener(e,t,i,s){this.eventEmitter.addEventListener(e,t,i,s)}contentComplete(){}dispatchEvent(e){return a.debug(G,"dispatchEvent",e),!0}getSettings(){return this.imaSdkSettings}getVersion(){return"custom"}removeEventListener(e,t,i,s){this.eventEmitter.removeEventListener(e,t,i)}requestAds(e,t){if(this.userRequestContext=t||void 0,!e.adTagUrl){let s=new T(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,"AdManager is already defined or adTagUrl is not defined");this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new g(s));return}this.adsManager=new D(e,this.adDisplayContainer),this.adsManager.fetchVmap().then(s=>(this.adsManager=s,this.eventEmitter.emit(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,new I(s)))).catch(s=>{let d=s.message||"Unable to retrive vmap files",p=new T(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,s.message||"Unable to retrive vmap files");return a.error(G,d,p),this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new g(p))})}destroy(){this.adsManager?.destroy(),this.adDisplayContainer.destroy(),this.eventEmitter.clearAllEventListeners()}};var Y=class{autoAlign=!1;bitrate=-1;enablePreloading=!1;loadVideoTimeout=-1;mimeTypes=null;playAdsAfterTime=0;restoreCustomPlaybackStateOnAdBreakComplete=!1;uiElements=null;useStyledLinearAds=!0;useStyledNonLinearAds=!1};var F="ima:AdsRequest",K=class{adTagUrl;adsResponse;contentDuration;contentKeywords;contentTitle;forceNonLinearFullSlot;linearAdSlotHeight;linearAdSlotWidth;liveStreamPrefetchSeconds;nonLinearAdSlotHeight;nonLinearAdSlotWidth;omidAccessModeRules;pageUrl;vastLoadTimeout;constructor(){this.adTagUrl="",this.adsResponse=null,this.contentDuration=null,this.contentKeywords=null,this.contentTitle=null,this.forceNonLinearFullSlot=!1,this.linearAdSlotHeight=0,this.linearAdSlotWidth=0,this.liveStreamPrefetchSeconds=0,this.nonLinearAdSlotHeight=0,this.nonLinearAdSlotWidth=0,this.omidAccessModeRules={},this.pageUrl=null,this.vastLoadTimeout=0}setAdWillAutoPlay(e){a.debug(F,`setAdWillAutoPlay [${e}]`)}setAdWillPlayMuted(e){a.debug(F,`setAdWillPlayMuted [${e}]`)}setContinuousPlayback(e){a.debug(F,`setContinuousPlayback [${e}]`)}};function Gi(u,e="debug"){a.setEnable(u),a.setLogLevel(e)}var Ji=N;String.prototype.trimStart||(String.prototype.trimStart=String.prototype.trimLeft);typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(u){return this.indexOf(u,this.length-u.length)!==-1});var Ln=H;export{y as Ad,q as AdDisplayContainer,T as AdError,g as AdErrorEvent,L as AdEvent,R as AdPodInfo,Q as AdsLoader,D as AdsManager,I as AdsManagerLoadedEvent,Y as AdsRenderingSettings,K as AdsRequest,A as ImaSdkSettings,Ln as VERSION,Ji as ViewMode,Gi as activateDebug,Z as settings};
/* Built on 2025-05-04T19:37:23.291Z */
