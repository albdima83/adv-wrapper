/* CJS | Version: 0.0.3 | Commit: 4a11a5e */
"use strict";var M=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var z=(a,e)=>{for(var t in e)M(a,t,{get:e[t],enumerable:!0})},X=(a,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Y(e))!$.call(a,n)&&n!==t&&M(a,n,{get:()=>e[n],enumerable:!(i=K(e,n))||i.enumerable});return a};var Z=a=>X(M({},"__esModule",{value:!0}),a);var oe={};z(oe,{Ad:()=>L,AdDisplayContainer:()=>k,AdError:()=>T,AdErrorEvent:()=>y,AdEvent:()=>c,AdPodInfo:()=>R,AdsLoader:()=>x,AdsManager:()=>D,AdsManagerLoadedEvent:()=>_,AdsRenderingSettings:()=>N,AdsRequest:()=>U,ImaSdkSettings:()=>f,VERSION:()=>ae,ViewMode:()=>Q,activateDebug:()=>re,settings:()=>B});module.exports=Z(oe);var F="0.0.3";var f;(i=>{let a;(o=>(o.ALWAYS="always",o.ON_MASTER_AD="on_master_ad"))(a=i.CompanionBackfillMode||(i.CompanionBackfillMode={}));let e;(d=>(d[d.DISABLED=0]="DISABLED",d[d.ENABLED=1]="ENABLED",d[d.INSECURE=2]="INSECURE"))(e=i.VpaidMode||(i.VpaidMode={}));class t{getCompanionBackfill(){return"always"}getDisableCustomPlaybackForIOS10Plus(){return!0}getFeatureFlags(){return{}}getLocale(){return""}getNumRedirects(){return-1}getPlayerType(){return"lib"}getPlayerVersion(){return"1.0.0"}getPpid(){return""}isCookiesEnabled(){return!1}setAutoPlayAdBreaks(r){}setCompanionBackfill(){}setCookiesEnabled(r){}setDisableCustomPlaybackForIOS10Plus(r){}setFeatureFlags(r){}setLocale(r){}setNumRedirects(r){}setPlayerType(r){}setPlayerVersion(r){}setPpid(r){}setSessionId(r){}setVpaidAllowed(r){}setVpaidMode(r){}}i.ImaSdkSettings=t})(f||(f={}));var B=new f.ImaSdkSettings;var L=class{adId;adPodInfo;adSystem;advertiserName;apiFramework;companionAds;creativeAdId;creativeId;dealId;description;duration;height;mediaUrl;minSuggestedDuration;skipTimeOffset;surveyUrl;title;traffickingParameters;traffickingParametersString;uiElements;universalAdIdRegistry;universalAdIdValue;universalAdIds;vastMediaBitrate;vastMediaHeight;vastMediaWidth;width;wrapperAdIds;wrapperAdSystems;wrapperCreativeIds;linear;constructor(e,t,i,n){this.adId=e.id||"undefined",this.adPodInfo=n,this.adSystem=e.adSystem||"",this.advertiserName=e.advertiser||"",this.apiFramework=t.apiFramework||"",this.companionAds=[],this.creativeAdId=t.adId||"",this.creativeId=t.id||"",this.dealId="",this.description=e.description||"",this.duration=t.duration||0,this.height=0,this.mediaUrl=null,this.minSuggestedDuration=0,this.skipTimeOffset=t.skipDelay||-1,this.surveyUrl=null,this.title=e.adTitle||"",this.traffickingParameters={},this.traffickingParametersString="",this.uiElements=[],this.universalAdIdRegistry="",this.universalAdIdValue="",this.universalAdIds=[],this.vastMediaBitrate=0,this.vastMediaHeight=0,this.vastMediaWidth=0,this.width=0,this.wrapperAdIds=[],this.wrapperAdSystems=[],this.wrapperCreativeIds=[],this.linear=t.type==="linear"}getAdId(){return this.adId}getAdPodInfo(){return this.adPodInfo}getAdSystem(){return this.adSystem}getAdvertiserName(){return this.advertiserName}getApiFramework(){return this.apiFramework}getCompanionAds(e,t,i){return this.companionAds}getCreativeAdId(){return this.creativeAdId}getCreativeId(){return this.creativeId}getDealId(){return this.dealId}getDescription(){return this.description}getDuration(){return this.duration}getHeight(){return this.height}getMediaUrl(){return this.mediaUrl}getMinSuggestedDuration(){return this.minSuggestedDuration}getSkipTimeOffset(){return this.skipTimeOffset}getSurveyUrl(){return this.surveyUrl}getTitle(){return this.title}getTraffickingParameters(){return this.traffickingParameters}getTraffickingParametersString(){return this.traffickingParametersString}getUiElements(){return this.uiElements}getUniversalAdIdRegistry(){throw new Error("Method not implemented.")}getUniversalAdIdValue(){return this.universalAdIdValue}getUniversalAdIds(){return this.universalAdIds}getVastMediaBitrate(){return this.vastMediaBitrate}getVastMediaHeight(){return this.vastMediaHeight}getVastMediaWidth(){return this.vastMediaWidth}getWidth(){return this.width}getWrapperAdIds(){return this.wrapperAdIds}getWrapperAdSystems(){return this.wrapperAdSystems}getWrapperCreativeIds(){return this.wrapperCreativeIds}isLinear(){return this.linear}};var H=["debug","info","warn","error","fatal","trace"],ee={debug:console.debug||console.log,info:console.info||console.log,warn:console.warn||console.log,error:console.error||console.log,fatal:console.error||console.log,trace:console.trace||console.log},P=class{enable;level;constructor(e){this.enable=e.enable||!1,this.level=e.level||"info"}debug(e,t,...i){this.log("debug",e,t,...i)}info(e,t,...i){this.log("info",e,t,...i)}warn(e,t,...i){this.log("warn",e,t,...i)}error(e,t,...i){this.log("error",e,t,...i)}setLogLevel(e){this.level=e}setEnable(e){this.enable=e}log(e,t,i,...n){if(this.enable&&H.indexOf(e)>=H.indexOf(this.level)){let r=new Date().toISOString();(ee[e]??console.log)(`[${t}][${e}]`,i,...n)}}},te=new P({enable:!1,level:"error"}),h=te;var j="ima:AdDisplayContainer",k=class{adContainer;videoElement;contentElement;adsContainerElement;adsSpinnerElement;videoAdsElement;constructor(e,t,i){this.adContainer=e,this.videoElement=t,this.contentElement=i}initialize(){h.debug(j,"initialize"),this.adsContainerElement||(this.adsContainerElement=this.createAdsContainer()),this.videoAdsElement||(this.videoAdsElement=this.createAdsVideoElement()),this.adsSpinnerElement||(this.adsSpinnerElement=this.createAdsSpinner())}destroy(){var e,t,i;h.debug(j,"destroy"),(e=this.videoAdsElement)==null||e.remove(),(t=this.adsSpinnerElement)==null||t.remove(),(i=this.adsContainerElement)==null||i.remove(),this.videoAdsElement=void 0}addEventListener(e,t,i){}removeEventListener(e,t,i){}dispatchEvent(e){return!0}getVideoAdsElement(){return this.videoAdsElement||this.videoElement}show(){let e=this.adsContainerElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}hide(){let e=this.adsContainerElement;e&&(e.style.display="none",e.style.visibility="hidden",e.style.opacity="0")}showLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="block")}hideLoader(){let e=this.adsSpinnerElement;e&&(e.style.visibility="none")}hideAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.visibility="hidden",e.style.opacity="0")}showAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="block",e.style.visibility="visible",e.style.opacity="1")}clearAdVideoElement(){let e=this.videoAdsElement;e&&(e.style.display="none",e.autoplay=!1,e.pause(),e.src="",e.load())}createAdsContainer(){let e=this.adContainer;if(!e)return;let t=document.getElementById("adm-adv-container")||document.createElement("div");return t.id="adm-adv-container",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.background="rgb(0,0,0)",t.style.display="none",e.appendChild(t),t}createAdsSpinner(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-adv-spinner")||document.createElement("div");t.id="adm-adv-spinner",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.width="40px",t.style.height="40px",t.style.border="5px solid #ccc",t.style.borderTop="5px solid #333",t.style.borderRadius="50%",t.style.zIndex="10",t.style.animation="adm-spinner-animation 1s linear infinite",t.style.display="none";let i=document.createElement("style");return i.textContent=`
      @keyframes adm-spinner-animation {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
      }
    `,globalThis&&globalThis.document&&document.head.appendChild(i),e.appendChild(t),t}createAdsVideoElement(){let e=this.adsContainerElement;if(!e)return;let t=document.getElementById("adm-video-ads")||document.createElement("video");return t.id="adm-video-ads",t.style.position="absolute",t.style.inset="0",t.style.top="0",t.style.left="0",t.style.right="0",t.style.bottom="0",t.style.width="100%",t.style.height="100%",t.style.objectFit="cover",t.style.background="black",t.controls=!1,t.playsInline=!1,t.setAttribute("disablePictureInPicture",""),t.setAttribute("disableRemotePlayback",""),t.setAttribute("playsinline","false"),t.setAttribute("webkit-playsinline","false"),t.setAttribute("x-webkit-airplay","allow"),t.setAttribute("object","fit"),t.removeAttribute("controls"),e.appendChild(t),t}};var T;(i=>{let a;(s=>(s[s.VAST_MALFORMED_RESPONSE=100]="VAST_MALFORMED_RESPONSE",s[s.VAST_SCHEMA_VALIDATION_ERROR=101]="VAST_SCHEMA_VALIDATION_ERROR",s[s.VAST_UNSUPPORTED_VERSION=102]="VAST_UNSUPPORTED_VERSION",s[s.VAST_TRAFFICKING_ERROR=200]="VAST_TRAFFICKING_ERROR",s[s.VAST_UNEXPECTED_LINEARITY=201]="VAST_UNEXPECTED_LINEARITY",s[s.VAST_UNEXPECTED_DURATION_ERROR=202]="VAST_UNEXPECTED_DURATION_ERROR",s[s.VAST_WRAPPER_ERROR=300]="VAST_WRAPPER_ERROR",s[s.VAST_LOAD_TIMEOUT=301]="VAST_LOAD_TIMEOUT",s[s.VAST_TOO_MANY_REDIRECTS=302]="VAST_TOO_MANY_REDIRECTS",s[s.VAST_NO_ADS_AFTER_WRAPPER=303]="VAST_NO_ADS_AFTER_WRAPPER",s[s.VIDEO_PLAY_ERROR=400]="VIDEO_PLAY_ERROR",s[s.VAST_MEDIA_LOAD_TIMEOUT=402]="VAST_MEDIA_LOAD_TIMEOUT",s[s.VAST_LINEAR_ASSET_MISMATCH=403]="VAST_LINEAR_ASSET_MISMATCH",s[s.VAST_PROBLEM_DISPLAYING_MEDIA_FILE=405]="VAST_PROBLEM_DISPLAYING_MEDIA_FILE",s[s.OVERLAY_AD_PLAYING_FAILED=500]="OVERLAY_AD_PLAYING_FAILED",s[s.NONLINEAR_DIMENSIONS_ERROR=501]="NONLINEAR_DIMENSIONS_ERROR",s[s.OVERLAY_AD_LOADING_FAILED=502]="OVERLAY_AD_LOADING_FAILED",s[s.VAST_NONLINEAR_ASSET_MISMATCH=503]="VAST_NONLINEAR_ASSET_MISMATCH",s[s.COMPANION_REQUIRED_ERROR=602]="COMPANION_REQUIRED_ERROR",s[s.COMPANION_AD_LOADING_FAILED=603]="COMPANION_AD_LOADING_FAILED",s[s.UNKNOWN_ERROR=900]="UNKNOWN_ERROR",s[s.VPAID_ERROR=901]="VPAID_ERROR",s[s.FAILED_TO_REQUEST_ADS=1005]="FAILED_TO_REQUEST_ADS",s[s.VAST_ASSET_NOT_FOUND=1007]="VAST_ASSET_NOT_FOUND",s[s.VAST_EMPTY_RESPONSE=1009]="VAST_EMPTY_RESPONSE",s[s.UNKNOWN_AD_RESPONSE=1010]="UNKNOWN_AD_RESPONSE",s[s.ADS_REQUEST_NETWORK_ERROR=1012]="ADS_REQUEST_NETWORK_ERROR",s[s.INVALID_AD_TAG=1013]="INVALID_AD_TAG",s[s.PROTECTED_AUDIENCE_API_ERROR=1014]="PROTECTED_AUDIENCE_API_ERROR",s[s.STREAM_INITIALIZATION_FAILED=1020]="STREAM_INITIALIZATION_FAILED",s[s.ASSET_FALLBACK_FAILED=1021]="ASSET_FALLBACK_FAILED",s[s.UNSUPPORTED_URL=1022]="UNSUPPORTED_URL",s[s.INVALID_ARGUMENTS=1101]="INVALID_ARGUMENTS",s[s.NATIVE_MESSAGE_ERROR=1204]="NATIVE_MESSAGE_ERROR",s[s.AUTOPLAY_DISALLOWED=1205]="AUTOPLAY_DISALLOWED",s[s.CONSENT_MANAGEMENT_PROVIDER_NOT_READY=1300]="CONSENT_MANAGEMENT_PROVIDER_NOT_READY"))(a=i.ErrorCode||(i.ErrorCode={}));let e;(o=>(o.AD_LOAD="adLoadError",o.AD_PLAY="adPlayError"))(e||(e={}));class t{name;code;message;stack;cause;constructor(r,o){this.name="AdError",this.message=o,this.code=r}getErrorCode(){return this.code}getInnerError(){return new Error(this.message)}getMessage(){throw this.message}getType(){throw""}getVastErrorCode(){throw this.code}}i.AdError=t})(T||(T={}));var y;(t=>{let a;(n=>n.AD_ERROR="adError")(a=t.Type||(t.Type={}));class e{target;currentTarget;type="adError";adError;userRequestContext;constructor(n,r){this.adError=n,this.userRequestContext=r}getError(){return this.adError||null}getUserRequestContext(){return this.userRequestContext||null}preventDefault(){}stopPropagation(){}}t.AdErrorEvent=e})(y||(y={}));var c;(t=>{let a;(l=>(l.AD_BREAK_FETCH_ERROR="adBreakFetchError",l.AD_BREAK_READY="adBreakReady",l.AD_BUFFERING="adBuffering",l.AD_CAN_PLAY="adCanPlay",l.AD_METADATA="adMetadata",l.AD_PROGRESS="adProgress",l.ALL_ADS_COMPLETED="allAdsCompleted",l.CLICK="click",l.COMPLETE="complete",l.CONTENT_PAUSE_REQUESTED="contentPauseRequested",l.CONTENT_RESUME_REQUESTED="contentResumeRequested",l.DURATION_CHANGE="durationChange",l.FIRST_QUARTILE="firstquartile",l.IMPRESSION="impression",l.INTERACTION="interaction",l.LINEAR_CHANGED="linearChanged",l.LOADED="loaded",l.LOG="log",l.MIDPOINT="midpoint",l.PAUSED="pause",l.RESUMED="resume",l.SKIPPABLE_STATE_CHANGED="skippableStateChanged",l.SKIPPED="skipped",l.STARTED="start",l.THIRD_QUARTILE="thirdquartile",l.USER_CLOSE="userClose",l.VIDEO_CLICKED="videoClicked",l.VIDEO_ICON_CLICKED="videoIconClicked",l.VOLUME_CHANGED="volumeChanged",l.VOLUME_MUTED="volumeMuted"))(a=t.Type||(t.Type={}));class e{currentTarget;target;type="loaded";ad=void 0;adData=null;constructor(n,r){this.type=n,this.ad=r}getAd(){return this.ad||null}getAdData(){return this.adData}preventDefault(){}stopPropagation(){}}t.AdEvent=e})(c||(c={}));var R=class{adPosition;isBumper;maxDuration;podIndex;timeOffset;totalAds;constructor(e,t,i,n,r,o){this.adPosition=e,this.isBumper=t,this.maxDuration=i,this.podIndex=n,this.timeOffset=r,this.totalAds=o}getAdPosition(){return this.adPosition}getIsBumper(){return this.isBumper}getMaxDuration(){return this.maxDuration}getPodIndex(){return this.podIndex}getTimeOffset(){return this.timeOffset}getTotalAds(){return this.totalAds}};var S=class{listeners={};addEventListener(e,t,i=!1,n=null){if(t===null)throw new Error("Handler cannot be null");this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({handler:t instanceof Function?t:t==null?void 0:t.handleEvent,scope:n,capture:i})}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach(i=>{i.handler.apply(i.scope,t)})}removeEventListener(e,t,i=!1){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(n=>n.handler!==(t instanceof Function?t:t==null?void 0:t.handleEvent)||n.capture!==i))}clearEventListeners(e){this.listeners[e]&&delete this.listeners[e]}clearAllEventListeners(){this.listeners={}}};var C=require("@dailymotion/vast-client"),G=require("fast-xml-parser");var ie=/^\d{2}:\d{2}(?::\d{2}(?:\.\d{3})?)?$/;function O(a){if(a=="start"||a=="end")return 0;if(ie.test(a)){let[e="00",t="00",i="00"]=a.split(":"),n="00",r="000";return i.includes(".")?[n,r]=i.split("."):n=i,(parseInt(e,10)*3600+parseInt(t,10)*60+parseInt(n,10))*1e3+parseInt(r,10)}return parseFloat(a)}function q(a){return new Promise((e,t)=>{a.preload="auto",a.load();let i=()=>{a.removeEventListener("canplay",i),e()},n=()=>{a.removeEventListener("error",n),t(new Error("Video failed to load"))};a.addEventListener("canplaythrough",i),a.addEventListener("error",n)})}var W=["play","pause","ended","waiting","stalled","canplay","playing","seeking","seeked","timeupdate","durationchange","loadedmetadata","suspend","abort"],ne=500,g="ima:AdsManager",D=class{adsRequest;adDisplayContainer;adsRenderingSettings=void 0;vastTracker;content=void 0;eventEmitter;cuePoints;cueMapPoints;started=!1;nextAds=[];totalAds=0;totalTimeAds=0;currentPodIndex=0;canBeAdSkippable=!1;currentAdBreak=void 0;currentAdVast=void 0;currentAd=void 0;currentCreative=void 0;queueCreatives=[];processingAdv=!1;timerUpdateContentTime=void 0;adRemainingTime=-1;adDuration=-1;quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1};constructor(e,t){this.adsRequest=e,this.adDisplayContainer=t,this.eventEmitter=new S,this.content=void 0,this.cuePoints=[],this.cueMapPoints={},this.adsRenderingSettings=void 0,this.started=!1,this.processingAdv=!1,this.canBeAdSkippable=!1,this.adRemainingTime=-1,this.adDuration=-1,this.fetchVmap=this.fetchVmap.bind(this),this.attachContentMediaEventListeners=this.attachContentMediaEventListeners.bind(this),this.detachContentMediaEventListeners=this.detachContentMediaEventListeners.bind(this),this.handleContentTimeUpdate=this.handleContentTimeUpdate.bind(this),this.adsVideoEventsListener=this.adsVideoEventsListener.bind(this),this.adsVideoErrorListener=this.adsVideoErrorListener.bind(this)}collapse(){throw new Error("Method not implemented.")}configureAdsManager(e,t){this.content=e,this.adsRenderingSettings=t||void 0}destroy(){this.detachContentMediaEventListeners(),this.eventEmitter.clearAllEventListeners(),this.content=void 0,this.adsRenderingSettings=void 0}discardAdBreak(){}expand(){}focus(){}getAdSkippableState(){return this.canBeAdSkippable}getCuePoints(){return this.cuePoints}getRemainingTime(){return this.currentCreative?this.adRemainingTime:-1}getVolume(){return this.adDisplayContainer.getVideoAdsElement().volume}init(e,t,i,n){}isCustomClickTrackingUsed(){throw new Error("Method not implemented.")}isCustomPlaybackUsed(){throw new Error("Method not implemented.")}pause(){throw new Error("Method not implemented.")}resize(e,t,i){throw new Error("Method not implemented.")}resume(){throw new Error("Method not implemented.")}setVolume(e){let t=this.adDisplayContainer.getVideoAdsElement();t&&(t.volume=e)}skip(){var i,n;let e=this.adDisplayContainer.getVideoAdsElement(),t=((i=this.currentCreative)==null?void 0:i.skipDelay)||0;if(!(!e||t<=0||this.adRemainingTime>t&&this.adRemainingTime<this.adDuration))try{e.pause()}finally{h.debug(g,"video user skipped"),(n=this.vastTracker)==null||n.skip(),this.dispatchAdsEvent(c.Type.SKIPPED),this.playCreativities()}}start(){this.started||(this.started=!0,this.fetchVastAds(0),this.attachContentMediaEventListeners())}stop(){this.started=!1}updateAdsRenderingSettings(e){throw new Error("Method not implemented.")}addEventListener(e,t,i,n){this.eventEmitter.addEventListener(e,t,i,n)}removeEventListener(e,t,i,n){this.eventEmitter.removeEventListener(e,t,i)}dispatchEvent(e){return!0}fetchVmap(){let e=this.adsRequest.adTagUrl;return fetch(e).then(t=>t.text()).then(t=>{let n=new G.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",textNodeName:"#text"}).parse(t),r=n==null?void 0:n["vmap:VMAP"]["vmap:AdBreak"];if(!r)return this;if(Array.isArray(r))r.forEach(o=>{let d=o["@_timeOffset"];if(d){let u=O(d);if(!isNaN(u)&&this.isValidAdBreak(o)){h.debug(g,`vmap adBreak timeOffset [${d}]:`,u),this.cuePoints.includes(u)||this.cuePoints.push(u);let v=this.cueMapPoints[u]||[];v.push(o),this.cueMapPoints[u]=v}}});else{let o=r["@_timeOffset"];if(o){let d=O(o);!isNaN(d)&&this.isValidAdBreak(r)&&(this.cuePoints.push(d),this.cueMapPoints[d]=[r])}}return this.adDisplayContainer.initialize(),this}).catch(t=>Promise.reject(t))}isValidContentObject(e){return!!e&&(e instanceof HTMLVideoElement||"currentTime"in e)}allAdsCompleted(){var e,t,i;this.removeVideoListeners(),this.dispatchAdsEvent(c.Type.ALL_ADS_COMPLETED),this.nextAds=[],this.queueCreatives=[],this.vastTracker=void 0,this.currentAdVast=void 0,this.currentAdBreak=void 0,this.currentAd=void 0,this.currentCreative=void 0,this.adRemainingTime=-1,this.canBeAdSkippable=!1,(e=this.adDisplayContainer)==null||e.hideAdVideoElement(),(t=this.adDisplayContainer)==null||t.clearAdVideoElement(),(i=this.adDisplayContainer)==null||i.hide(),this.processingAdv=!1,this.dispatchAdsEvent(c.Type.CONTENT_RESUME_REQUESTED)}playCreativities(){this.processingAdv=!0;let e=!!this.currentAd;if(this.currentCreative=void 0,this.currentAdVast&&this.queueCreatives.length>0){let i=this.queueCreatives.shift();if(!i)return this.playCreativities();let n=i.mediaFiles;if(n&&n.length>0)for(let r of n){let o=r.mimeType;if(o&&o.startsWith("video/mp4")&&r.fileURL){this.currentCreative=i,this.vastTracker=new C.VASTTracker(null,this.currentAdVast,this.currentCreative);let d=this.totalAds-this.nextAds.length,u=new R(d,!1,this.totalTimeAds,this.currentPodIndex,0,this.totalAds);h.debug(g,`current podInfo: [${d}] [${this.totalTimeAds}] [${this.totalAds}]`),this.currentAd=new L(this.currentAdVast,i,r,u),e||this.dispatchAdsEvent(c.Type.CONTENT_PAUSE_REQUESTED),this.playAdsContent(r.fileURL).catch(v=>{});return}}return this.playCreativities()}if(!this.nextAds||this.nextAds.length===0){this.allAdsCompleted();return}let t=this.nextAds.shift();return t?(this.currentAdVast=t,this.queueCreatives=this.getCreativities(t),this.playCreativities()):this.playCreativities()}handleContentTimeUpdate(){let e=this.content;if(!this.isValidContentObject(e)||this.cuePoints.length===0||this.processingAdv)return;if(this.nextAds&&this.nextAds.length>0){this.processingAdv=!0,this.playCreativities();return}let t=e.currentTime*1e3;h.debug(g,`Content current time: [${t}]`);let i=this.cuePoints.find(n=>Math.abs(n-t)<=ne);i&&this.fetchVastAds(i)}clearTimerUpdateContentTime(){clearTimeout(this.timerUpdateContentTime)}startTimerUpdateContentTime(){this.clearTimerUpdateContentTime(),this.timerUpdateContentTime=setTimeout(()=>{this.handleContentTimeUpdate(),this.startTimerUpdateContentTime()},300)}attachContentMediaEventListeners(){let e=this.content;e&&(e instanceof HTMLVideoElement?e.addEventListener("timeupdate",this.handleContentTimeUpdate):"currentTime"in e&&this.startTimerUpdateContentTime())}detachContentMediaEventListeners(){let e=this.content;if(e)if(e instanceof HTMLVideoElement){let t=e}else"currentTime"in e}isValidAdBreak(e){var n,r;let t=e["vmap:AdSource"];return!(!t||!((r=(n=t["vmap:AdTagURI"])==null?void 0:n["#text"])==null?void 0:r.trim()))}getAdValidCreative(e){let t=e.creatives;if(t&&t.length>0){for(let i of t)if(i.type==="linear"){let o=i.mediaFiles;if(o&&o.length>0)for(let d of o){let u=d.mimeType;if(u&&u.startsWith("video/mp4")&&d.fileURL)return i}}}}getCreativities(e){let t=[],i=e.creatives;if(i&&i.length>0){for(let n of i)if(n.type==="linear"){let d=n.mediaFiles;if(d&&d.length>0)for(let u of d){let v=u.mimeType;if(v&&v.startsWith("video/mp4")&&u.fileURL){t.push(n);break}}}}return t}trackingEvent(e){let t=this.currentCreative;if(!t)return;let i=t.trackingEvents,n=i==null?void 0:i[e];if(n)for(let r of n)this.trackUrl(r)}trackUrl(e){try{if(globalThis){let t=new globalThis.Image;t.src=e}}catch{}}getPromiseVastClient(e){return new C.VASTClient().get(e)}async fetchVastAds(e){var t,i,n;if(this.started)try{this.currentPodIndex=e;let r=this.cueMapPoints[e];delete this.cueMapPoints[e];let o=[],d=0,u=0;if(r){let v=[];for(let I of r){let A=I["vmap:AdSource"];if(A){let b=(i=(t=A["vmap:AdTagURI"])==null?void 0:t["#text"])==null?void 0:i.trim();b&&o.push(this.getPromiseVastClient(b))}}let E=await Promise.allSettled(o);for(let I of E)if(I.status==="fulfilled"){let A=I.value,b=(A==null?void 0:A.ads)??void 0;if(b&&b.length>0)for(let V of b){let w=this.getAdValidCreative(V);w&&(v.push(V),d+=w.duration||0,u+=1)}else(n=A.errorURLTemplates)==null||n.forEach(V=>{this.trackUrl(V)})}this.nextAds=v,this.totalAds=u,this.totalTimeAds=d,this.nextAds.length===0?this.allAdsCompleted():this.playCreativities()}}catch(r){h.error(g,"fetchVastAds error:",r)}}dispatchAdsEvent(e){h.debug(g,"dispatchAdsEvent: ",e),this.eventEmitter.emit(e,new c.AdEvent(e,this.currentAd))}adsVideoEventsListener(e){var i,n,r;let t=this.adDisplayContainer.getVideoAdsElement();if(t)switch(e.type){case"canplay":{this.dispatchAdsEvent(c.Type.AD_CAN_PLAY);break}case"metadata":{this.dispatchAdsEvent(c.Type.AD_METADATA);break}case"play":{this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(c.Type.STARTED));break}case"pause":{this.dispatchAdsEvent(c.Type.PAUSED);break}case"timeupdate":{let o=t.duration||-1;if(!isNaN(o)&&o>=0){let d=t.currentTime||0,u=d/o,v=o-d,E=((i=this.currentCreative)==null?void 0:i.skipDelay)||0;this.adRemainingTime=v,this.adDuration=o,h.debug(g,`video adv currentTime: ${d}, Percentage: ${u}%, SkipDelay: ${E}`),this.quartilesFired.start||(this.quartilesFired.start=!0,this.dispatchAdsEvent(c.Type.STARTED)),!this.quartilesFired.firstQuartile&&u>=.25&&(this.quartilesFired.firstQuartile=!0,this.dispatchAdsEvent(c.Type.FIRST_QUARTILE)),!this.quartilesFired.midpoint&&u>=.5&&(this.quartilesFired.midpoint=!0,this.dispatchAdsEvent(c.Type.MIDPOINT)),!this.quartilesFired.thirdQuartile&&u>=.75&&(this.quartilesFired.thirdQuartile=!0,this.dispatchAdsEvent(c.Type.THIRD_QUARTILE)),(n=this.vastTracker)==null||n.setProgress(d),!this.canBeAdSkippable&&E>0&&d>=E&&(this.canBeAdSkippable=!0,h.debug(g,`video adv can be skippable: [${d}] [${o}] [${E}]`),this.dispatchAdsEvent(c.Type.SKIPPABLE_STATE_CHANGED))}break}case"ended":{this.adRemainingTime=-1,this.adDuration=-1,this.quartilesFired.complete||(this.quartilesFired.complete=!0,this.dispatchAdsEvent(c.Type.COMPLETE)),(r=this.vastTracker)==null||r.complete(),this.playCreativities();break}}}adsVideoErrorListener(e){var t,i;(t=this.adDisplayContainer)==null||t.hideAdVideoElement(),(i=this.adDisplayContainer)==null||i.clearAdVideoElement(),this.playCreativities()}resetQuartilesFired(){this.quartilesFired={start:!1,firstQuartile:!1,midpoint:!1,thirdQuartile:!1,complete:!1}}async playAdsContent(e){var i,n,r,o,d,u;let t=this.adDisplayContainer.getVideoAdsElement();if(!t)return h.error(g,"playAdsContent no Video Ads Element: "),this.playCreativities();this.adRemainingTime=-1,this.adDuration=-1,this.canBeAdSkippable=!1,this.resetQuartilesFired(),this.removeVideoListeners(),(i=this.adDisplayContainer)==null||i.show(),(n=this.adDisplayContainer)==null||n.showLoader(),(r=this.adDisplayContainer)==null||r.hideAdVideoElement(),t.src=e,t.autoplay=!0;try{await q(t),await t.play(),this.addVideoListeners(),(o=this.adDisplayContainer)==null||o.showAdVideoElement(),(d=this.adDisplayContainer)==null||d.hideLoader(),this.dispatchAdsEvent(c.Type.AD_CAN_PLAY)}catch(v){h.error(g,"playAdsContent error: ",v),this.dispatchAdsEvent(c.Type.AD_BREAK_FETCH_ERROR),(u=this.adDisplayContainer)==null||u.hideAdVideoElement(),this.playCreativities()}finally{this.adDisplayContainer.hideLoader()}}addVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(W.forEach(t=>e.addEventListener(t,this.adsVideoEventsListener)),e.addEventListener("error",this.adsVideoErrorListener))}removeVideoListeners(){let e=this.adDisplayContainer.getVideoAdsElement();e&&(W.forEach(t=>e.removeEventListener(t,this.adsVideoEventsListener)),e.removeEventListener("error",this.adsVideoErrorListener))}};var _;(t=>{let a;(n=>n.ADS_MANAGER_LOADED="adsManagerLoaded")(a=t.Type||(t.Type={}));class e{currentTarget;target;type;adsManager;constructor(n){this.adsManager=n,this.currentTarget=null,this.target=null,this.type="adsManagerLoaded"}getAdsManager(n,r){return this.adsManager.configureAdsManager(n,r),this.adsManager}getUserRequestContext(){throw new Error("Method not implemented.")}preventDefault(){throw new Error("Method not implemented.")}stopPropagation(){throw new Error("Method not implemented.")}}t.AdsManagerLoadedEvent=e})(_||(_={}));var se="ima:AdsLoader",x=class{adDisplayContainer;adsManager=void 0;eventEmitter;userRequestContext=void 0;imaSdkSettings=new f.ImaSdkSettings;constructor(e){this.adDisplayContainer=e,this.eventEmitter=new S}addEventListener(e,t,i,n){this.eventEmitter.addEventListener(e,t,i,n)}contentComplete(){}dispatchEvent(e){return!0}getSettings(){return this.imaSdkSettings}getVersion(){return"custom"}removeEventListener(e,t,i,n){this.eventEmitter.removeEventListener(e,t,i)}requestAds(e,t){if(this.userRequestContext=t||void 0,!e.adTagUrl){let n=new T.AdError(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,"AdManager is already defined or adTagUrl is not defined");this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new y.AdErrorEvent(n));return}this.adsManager=new D(e,this.adDisplayContainer),this.adsManager.fetchVmap().then(n=>(this.adsManager=n,this.eventEmitter.emit(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,new _.AdsManagerLoadedEvent(n)))).catch(n=>{let r=n.message||"Unable to retrive vmap files",o=new T.AdError(google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,n.message||"Unable to retrive vmap files");return h.error(se,r,o),this.eventEmitter.emit(google.ima.AdErrorEvent.Type.AD_ERROR,new y.AdErrorEvent(o))})}destroy(){var e;(e=this.adsManager)==null||e.destroy(),this.adDisplayContainer.destroy(),this.eventEmitter.clearAllEventListeners()}};var N=class{autoAlign=!1;bitrate=-1;enablePreloading=!1;loadVideoTimeout=-1;mimeTypes=null;playAdsAfterTime=0;restoreCustomPlaybackStateOnAdBreakComplete=!1;uiElements=null;useStyledLinearAds=!0;useStyledNonLinearAds=!1};var U=class{adTagUrl;adsResponse;contentDuration;contentKeywords;contentTitle;forceNonLinearFullSlot;linearAdSlotHeight;linearAdSlotWidth;liveStreamPrefetchSeconds;nonLinearAdSlotHeight;nonLinearAdSlotWidth;omidAccessModeRules;pageUrl;vastLoadTimeout;constructor(){this.adTagUrl="",this.adsResponse=null,this.contentDuration=null,this.contentKeywords=null,this.contentTitle=null,this.forceNonLinearFullSlot=!1,this.linearAdSlotHeight=0,this.linearAdSlotWidth=0,this.liveStreamPrefetchSeconds=0,this.nonLinearAdSlotHeight=0,this.nonLinearAdSlotWidth=0,this.omidAccessModeRules={},this.pageUrl=null,this.vastLoadTimeout=0}setAdWillAutoPlay(e){}setAdWillPlayMuted(e){}setContinuousPlayback(e){}};function re(a,e="debug"){h.setEnable(a),h.setLogLevel(e)}var Q=(t=>(t.FULLSCREEN="fullscreen",t.NORMAL="normal",t))(Q||{});String.prototype.trimStart||(String.prototype.trimStart=String.prototype.trimLeft);typeof String.prototype.endsWith!="function"&&(String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1});var ae=F;0&&(module.exports={Ad,AdDisplayContainer,AdError,AdErrorEvent,AdEvent,AdPodInfo,AdsLoader,AdsManager,AdsManagerLoadedEvent,AdsRenderingSettings,AdsRequest,ImaSdkSettings,VERSION,ViewMode,activateDebug,settings});
/* Built on 2025-04-29T22:03:29.361Z */
